% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames*,x11names*}{xcolor}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Data Science Visualization},
  colorlinks=true,
  linkcolor=Maroon,
  filecolor=Maroon,
  citecolor=Blue,
  urlcolor=blue,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs}
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\title{Data Science Visualization}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

The textbook for the Data Science course series is
\href{https://rafalab.github.io/dsbook/}{freely available online}.

\hypertarget{learning-objectives}{%
\subsection{Learning Objectives}\label{learning-objectives}}

\begin{itemize}
\tightlist
\item
  Data visualization principles to better communicate data-driven
  findings
\item
  How to use ggplot2 to create custom plots
\item
  The weaknesses of several widely used plots and why you should avoid
  them
\end{itemize}

\hypertarget{course-overview}{%
\subsection{Course Overview}\label{course-overview}}

\hypertarget{section-1-introduction-to-data-visualization-and-distributions}{%
\subsubsection{Section 1: Introduction to Data Visualization and
Distributions}\label{section-1-introduction-to-data-visualization-and-distributions}}

You will get started with data visualization and distributions in R.

\hypertarget{section-2-introduction-to-ggplot2}{%
\subsubsection{Section 2: Introduction to
ggplot2}\label{section-2-introduction-to-ggplot2}}

You will learn how to use ggplot2 to create plots.

\hypertarget{section-3-summarizing-with-dplyr}{%
\subsubsection{Section 3: Summarizing with
dplyr}\label{section-3-summarizing-with-dplyr}}

You will learn how to summarize data using dplyr.

\hypertarget{section-4-gapminder}{%
\subsubsection{Section 4: Gapminder}\label{section-4-gapminder}}

You will see examples of ggplot2 and dplyr in action with the Gapminder
dataset.

\hypertarget{section-5-data-visualization-principles}{%
\subsubsection{Section 5: Data Visualization
Principles}\label{section-5-data-visualization-principles}}

You will learn general principles to guide you in developing effective
data visualizations.

\hypertarget{section-1-overview}{%
\subsection{Section 1 Overview}\label{section-1-overview}}

Section 1 introduces you to Data Visualization and Distributions.

After completing Section 1, you will:

\begin{itemize}
\tightlist
\item
  understand the importance of data visualization for communicating
  data-driven findings.
\item
  be able to use distributions to summarize data.
\item
  be able to use the average and the standard deviation to understand
  the normal distribution.
\item
  be able to assess how well a normal distribution fits the data using a
  quantile-quantile plot.
\item
  be able to interpret data from a boxplot.
\end{itemize}

\hypertarget{introduction-to-data-visualization}{%
\subsection{Introduction to Data
Visualization}\label{introduction-to-data-visualization}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/introduction-to-data-visualization.html}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Plots of data easily communicate information that is difficult to
  extract from tables of raw values.
\item
  Data visualization is a key component of exploratory data analysis
  (EDA), in which the properties of data are explored through
  visualization and summarization techniques.
\item
  Data visualization can help discover biases, systematic errors,
  mistakes and other unexpected problems in data before those data are
  incorporated into potentially flawed analysis.
\item
  This course covers the basics of data visualization and EDA in R using
  the \textbf{ggplot2} package and motivating examples from world
  health, economics and infectious disease.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(dslabs)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"dslabs"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: dslabs
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(murders)}
\KeywordTok{head}\NormalTok{(murders)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        state abb region population total
## 1    Alabama  AL  South    4779736   135
## 2     Alaska  AK   West     710231    19
## 3    Arizona  AZ   West    6392017   232
## 4   Arkansas  AR  South    2915918    93
## 5 California  CA   West   37253956  1257
## 6   Colorado  CO   West    5029196    65
\end{verbatim}

\hypertarget{introduction-to-distributions}{%
\subsection{Introduction to
Distributions}\label{introduction-to-distributions}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  The most basic statistical summary of a list of objects is its
  distribution.
\item
  We will learn ways to visualize and analyze distributions in the
  upcoming videos.
\item
  In some cases, data can be summarized by a two-number summary: the
  average and standard deviation. We will learn to use data
  visualization to determine when that is appropriate.
\end{itemize}

\hypertarget{data-types}{%
\subsection{Data Types}\label{data-types}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#variable-types}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Categorical data are variables that are defined by a small number of
  groups.

  \begin{itemize}
  \tightlist
  \item
    Ordinal categorical data have an inherent order to the categories
    (mild/medium/hot, for example).
  \item
    Non-ordinal categorical data have no order to the categories.
  \end{itemize}
\item
  Numerical data take a variety of numeric values.

  \begin{itemize}
  \tightlist
  \item
    Continuous variables can take any value.
  \item
    Discrete variables are limited to sets of specific values.
  \end{itemize}
\end{itemize}

\hypertarget{assessment---data-types}{%
\subsection{Assessment - Data Types}\label{assessment---data-types}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  The type of data we are working with will often influence the data
  visualization technique we use.
\end{enumerate}

We will be working with two types of variables: categorical and numeric.
Each can be divided into two other groups: categorical can be ordinal or
not, whereas numerical variables can be discrete or continuous.

We will review data types using some of the examples provided in the
\texttt{dslabs} package. For example, the \texttt{heights} dataset.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(heights)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(heights)}
\KeywordTok{names}\NormalTok{(heights)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "sex"    "height"
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  We saw that \texttt{sex} is the first variable. We know what values
  are represented by this variable and can confirm this by looking at
  the first few entires:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(heights)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      sex height
## 1   Male     75
## 2   Male     70
## 3   Male     68
## 4   Male     74
## 5   Male     61
## 6 Female     65
\end{verbatim}

What data type is the \texttt{sex} variable?

\begin{itemize}
\tightlist
\item[$\square$]
  A. Continuous
\item[$\boxtimes$]
  B. Categorical
\item[$\square$]
  C. Ordinal
\item[$\square$]
  D. None of the above
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Keep in mind that discrete numeric data can be considered ordinal.
\end{enumerate}

Although this is technically true, we usually reserve the term ordinal
data for variables belonging to a small number of different groups, with
each group having many members.

The \texttt{height} variable could be ordinal if, for example, we report
a small number of values such as short, medium, and tall. Let's explore
how many unique values are used by the heights variable. For this we can
use the \texttt{unique} function:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\KeywordTok{unique}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height}
\KeywordTok{length}\NormalTok{(}\KeywordTok{unique}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 139
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  One of the useful outputs of data visualization is that we can learn
  about the distribution of variables.
\end{enumerate}

For categorical data we can construct this distribution by simply
computing the frequency of each unique value. This can be done with the
function \texttt{table}. Here is an example:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\KeywordTok{table}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height}
\NormalTok{tab <-}\StringTok{ }\KeywordTok{table}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  To see why treating the reported heights as an ordinal value is not
  useful in practice we note how many values are reported only once.
\end{enumerate}

In the previous exercise we computed the variable tab which reports the
number of times each unique value appears. For values reported only once
tab will be 1. Use logicals and the function sum to count the number of
times this happens.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab <-}\StringTok{ }\KeywordTok{table}\NormalTok{(heights}\OperatorTok{$}\NormalTok{height)}
\KeywordTok{sum}\NormalTok{(tab}\OperatorTok{==}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 63
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Since there are a finite number of reported heights and technically
  the height can be considered ordinal, which of the following is true:
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  A. It is more effective to consider heights to be numerical given the
  number of unique values we observe and the fact that if we keep
  collecting data even more will be observed.
\item[$\square$]
  B. It is actually preferable to consider heights ordinal since on a
  computer there are only a finite number of possibilities.
\item[$\square$]
  C. This is actually a categorical variable: tall, medium or short.
\item[$\square$]
  D. This is a numerical variable because numbers are used to represent
  it.
\end{itemize}

\hypertarget{describe-heights-to-et}{%
\subsection{Describe Heights to ET}\label{describe-heights-to-et}}

The textbook for this section is available:

\begin{itemize}
\tightlist
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#case-study-describing-student-heights}{Case
  Study describing student heights}
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#distribution-function}{Distribution
  Function}
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#cdf-intro}{CDF
  Intro}
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#histograms}{Histograms}
\end{itemize}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  A distribution is a function or description that shows the possible
  values of a variable and how often those values occur.
\item
  For categorical variables, the distribution describes the proportions
  of each category.
\item
  A \emph{frequency table} is the simplest way to show a categorical
  distribution. Use \texttt{prop.table} to convert a table of counts to
  a frequency table. \emph{Barplots} display the distribution of
  categorical variables and are a way to visualize the information in
  frequency tables.
\item
  For continuous numerical data, reporting the frequency of each unique
  entry is not an effective summary as many or most values are unique.
  Instead, a distribution function is required.
\item
  The \emph{cumulative distribution function (CDF)} is a function that
  reports the proportion of data below a value \emph{a} for all values
  of \emph{a}: \(F(a) = Pr(x \le a)\).
\item
  The proportion of observations between any two values \emph{a} and
  \emph{b} can be computed from the CDF as \(F(b) - F(a)\).
\item
  A \emph{histogram} divides data into non-overlapping bins of the same
  size and plots the counts of number of values that fall in that
  interval.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load the dataset}
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(heights)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# make a table of category proportions}
\KeywordTok{prop.table}\NormalTok{(}\KeywordTok{table}\NormalTok{(heights}\OperatorTok{$}\NormalTok{sex))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##    Female      Male 
## 0.2266667 0.7733333
\end{verbatim}

\hypertarget{smooth-density-plots}{%
\subsection{Smooth Density Plots}\label{smooth-density-plots}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#smoothed-density}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  \emph{Smooth density plots} can be thought of as histograms where the
  bin width is extremely or infinitely small. The smoothing function
  makes estimates of the true continuous trend of the data given the
  available sample of data points.
\item
  The degree of smoothness can be controlled by an argument in the
  plotting function. (We will learn functions for plotting later.)
\item
  While the histogram is an assumption-free summary, the smooth density
  plot is shaped by assumptions and choices you make as a data analyst.
\item
  The y-axis is scaled so that the area under the density curve sums to
  1. This means that interpreting values on the y-axis is not
  straightforward. To determine the proportion of data in between two
  values, compute the area under the smooth density curve in the region
  between those values.
\item
  An advantage of smooth densities over histograms is that densities are
  easier to compare visually.
\end{itemize}

\textbf{A further note on histograms}: note that the choice of binwidth
has a determinative effect on shape. There is no ``true'' choice for
binwidth, and you can sometimes gain insights into the data by
experimenting with binwidths.

\newpage

\hypertarget{assessment---distributions}{%
\subsection{Assessment -
Distributions}\label{assessment---distributions}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  You may have noticed that numerical data is often summarized with the
  average value.
\end{enumerate}

For example, the quality of a high school is sometimes summarized with
one number: the average score on a standardized test. Occasionally, a
second number is reported: the standard deviation. So, for example, you
might read a report stating that scores were 680 plus or minus 50 (the
standard deviation). The report has summarized an entire vector of
scores with with just two numbers. Is this appropriate? Is there any
important piece of information that we are missing by only looking at
this summary rather than the entire list? We are going to learn when
these 2 numbers are enough and when we need more elaborate summaries and
plots to describe the data.

Our first data visualization building block is learning to summarize
lists of factors or numeric vectors. The most basic statistical summary
of a list of objects or numbers is its distribution. Once a vector has
been summarized as distribution, there are several data visualization
techniques to effectively relay this information. In later assessments
we will practice to write code for data visualization. Here we start
with some multiple choice questions to test your understanding of
distributions and related basic plots.

In the murders dataset, the region is a categorical variable and on the
right you can see its distribution. To the closest 5\%, what proportion
of the states are in the North Central region?

\begin{figure}
\centering
\includegraphics{images/Region vs Proportion.png}
\caption{Region vs.~Proportion}
\end{figure}

\begin{itemize}
\tightlist
\item[$\square$]
  A. 75\%
\item[$\square$]
  B. 50\%
\item[$\boxtimes$]
  C. 20\%
\item[$\square$]
  D. 5\%
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  In the murders dataset, the region is a categorical variable and to
  the right is its distribution.
\end{enumerate}

Which of the following is true:

\begin{itemize}
\tightlist
\item[$\square$]
  A. The graph above is a histogram.
\item[$\boxtimes$]
  B. The graph above shows only four numbers with a bar plot.
\item[$\square$]
  C. Categories are not numbers, so it does not make sense to graph the
  distribution.
\item[$\square$]
  D. The colors, not the height of the bars, describe the distribution.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  The plot shows the eCDF for male heights.
\end{enumerate}

Based on the plot, what percentage of males are shorter than 75 inches?

\begin{figure}
\centering
\includegraphics{images/eCDF for male heights.png}
\caption{eCDF for male heights}
\end{figure}

\begin{itemize}
\tightlist
\item[$\square$]
  A. 100\%
\item[$\boxtimes$]
  B. 95\%
\item[$\square$]
  C. 80\%
\item[$\square$]
  D. 72 inches
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  To the closest inch, what height \texttt{m} has the property that 1/2
  of the male students are taller than \texttt{m} and 1/2 are shorter?
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\square$]
  A. 61 inches
\item[$\square$]
  B. 64 inches
\item[$\boxtimes$]
  C. 69 inches
\item[$\square$]
  D. 74 inches
\end{itemize}

\newpage

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Here is an eCDF of the murder rates across states.
\end{enumerate}

\begin{figure}
\centering
\includegraphics{images/eCDF murder rates across states.png}
\caption{eCDF of the murder rates across states}
\end{figure}

Knowing that there are 51 states (counting DC) and based on this plot,
how many states have murder rates larger than 10 per 100,000 people?

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  A. 1
\item[$\square$]
  B. 5
\item[$\square$]
  C. 10
\item[$\square$]
  D. 50
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Based on the eCDF above, which of the following statements are true.
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\square$]
  A. About half the states have murder rates above 7 per 100,000 and the
  other half below.
\item[$\square$]
  B. Most states have murder rates below 2 per 100,000.
\item[$\square$]
  C. All the states have murder rates above 2 per 100,000.
\item[$\boxtimes$]
  D. With the exception of 4 states, the murder rates are below 5 per
  100,000.
\end{itemize}

\newpage

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Here is a histogram of male heights in our \texttt{heights} dataset.
\end{enumerate}

Based on this plot, how many males are between 62.5 and 65.5?

\begin{figure}
\centering
\includegraphics{images/Histogram of male heights.png}
\caption{Histogram of male heights}
\end{figure}

\begin{itemize}
\tightlist
\item[$\square$]
  A. 11
\item[$\square$]
  B. 29
\item[$\boxtimes$]
  C. 58
\item[$\square$]
  D. 99
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  About what percentage are shorter than 60 inches?
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  A. 1\%
\item[$\square$]
  B. 10\%
\item[$\square$]
  C. 25\%
\item[$\square$]
  D. 50\%
\end{itemize}

\newpage

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  Based on this density plot, about what proportion of US states have
  populations larger than 10 million?
\end{enumerate}

\begin{figure}
\centering
\includegraphics{images/Density plot population.png}
\caption{Density plot population}
\end{figure}

\begin{itemize}
\tightlist
\item[$\square$]
  A. 0.02
\item[$\boxtimes$]
  B. 0.15
\item[$\square$]
  C. 0.50
\item[$\square$]
  D. 0.55
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  Below are three density plots. Is it possible that they are from the
  same dataset?
\end{enumerate}

\begin{figure}
\centering
\includegraphics{images/Three density plots.png}
\caption{Three density plots}
\end{figure}

Which of the following statements is true?

\begin{itemize}
\tightlist
\item[$\square$]
  A. It is impossible that they are from the same dataset.
\item[$\square$]
  B. They are from the same dataset, but the plots are different due to
  code errors.
\item[$\square$]
  C. They are the same dataset, but the first and second plot
  undersmooth and the third oversmooths.
\item[$\boxtimes$]
  D. They are the same dataset, but the first is not in the log scale,
  the second undersmooths and the third oversmooths.
\end{itemize}

\newpage

\hypertarget{normal-distribution}{%
\subsection{Normal Distribution}\label{normal-distribution}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#normal-distribution}{here}

\textbf{Key points}

\begin{itemize}
\item
  The normal distribution:

  \begin{itemize}
  \tightlist
  \item
    Is centered around one value, the \emph{mean}
  \item
    Is symmetric around the mean
  \item
    Is defined completely by its mean (\(\mu\)) and standard deviation
    (\(\sigma\))
  \item
    Always has the same proportion of observations within a given
    distance of the mean (for example, 95\% within 2 \(\sigma\))
  \end{itemize}
\item
  The standard deviation is the average distance between a value and the
  mean value.
\item
  Calculate the mean using the \texttt{mean} function.
\item
  Calculate the standard deviation using the \texttt{sd} function or
  manually.
\item
  Standard units describe how many standard deviations a value is away
  from the mean. The z-score, or number of standard deviations an
  observation \emph{x} is away from the mean (\(\mu\)):

  \(Z = \frac{x - \mu}{\sigma}\)
\item
  Compute standard units with the \texttt{scale} function.
\item
  \textbf{Important:} to calculate the proportion of values that meet a
  certain condition, use the \texttt{mean} function on a logical vector.
  Because TRUE is converted to 1 and FALSE is converted to 0, taking the
  mean of this vector yields the proportion of TRUE.
\end{itemize}

\textbf{Equation for the normal distribution}

The normal distribution is mathematically defined by the following
formula for any mean \(\mu\) and standard deviation \(\sigma\):

\(Pr(a < x < b) = \int_{a}^{b} \frac{1}{\sqrt2\pi\sigma} e^-\frac{1}{2}(\frac{x - \mu}{\sigma})^2 dx\)

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(tidyverse)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: tidyverse
\end{verbatim}

\begin{verbatim}
## -- Attaching packages --------------------------------------------------------------------------------------------------------------------------------------------- tidyverse 1.3.0 --
\end{verbatim}

\begin{verbatim}
## v ggplot2 3.3.2     v purrr   0.3.4
## v tibble  3.0.3     v dplyr   1.0.0
## v tidyr   1.1.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------------------------------------------------------------------------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define x as vector of male heights}
\KeywordTok{library}\NormalTok{(tidyverse)}
\NormalTok{index <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Male"}
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[index]}

\CommentTok{# calculate the mean and standard deviation manually}
\NormalTok{average <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(x)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(x)}
\NormalTok{SD <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{sum}\NormalTok{((x }\OperatorTok{-}\StringTok{ }\NormalTok{average)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(x))}

\CommentTok{# built-in mean and sd functions - note that the audio and printed values disagree}
\NormalTok{average <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x)}
\NormalTok{SD <-}\StringTok{ }\KeywordTok{sd}\NormalTok{(x)}
\KeywordTok{c}\NormalTok{(}\DataTypeTok{average =}\NormalTok{ average, }\DataTypeTok{SD =}\NormalTok{ SD)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   average        SD 
## 69.314755  3.611024
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate standard units}
\NormalTok{z <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(x)}

\CommentTok{# calculate proportion of values within 2 SD of mean}
\KeywordTok{mean}\NormalTok{(}\KeywordTok{abs}\NormalTok{(z) }\OperatorTok{<}\StringTok{ }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9495074
\end{verbatim}

\textbf{Note about the sd function:} The built-in R function \texttt{sd}
calculates the standard deviation, but it divides by
\texttt{length(x)-1} instead of \texttt{length(x)}. When the length of
the list is large, this difference is negligible and you can use the
built-in \texttt{sd} function. Otherwise, you should compute \(\sigma\)
by hand. For this course series, assume that you should use the
\texttt{sd} function unless you are told not to do so.

\hypertarget{assessment---normal-distribution}{%
\subsection{Assessment - Normal
Distribution}\label{assessment---normal-distribution}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Histograms and density plots provide excellent summaries of a
  distribution.
\end{enumerate}

But can we summarize even further? We often see the average and standard
deviation used as summary statistics: a two number summary! To
understand what these summaries are and why they are so widely used, we
need to understand the normal distribution.

The normal distribution, also known as the bell curve and as the
Gaussian distribution, is one of the most famous mathematical concepts
in history. A reason for this is that approximately normal distributions
occur in many situations. Examples include gambling winnings, heights,
weights, blood pressure, standardized test scores, and experimental
measurement errors. Often data visualization is needed to confirm that
our data follows a normal distribution.

Here we focus on how the normal distribution helps us summarize data and
can be useful in practice.

One way the normal distribution is useful is that it can be used to
approximate the distribution of a list of numbers without having access
to the entire list. We will demonstrate this with the heights dataset.

Load the height data set and create a vector \texttt{x} with just the
male heights:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(heights)}
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

What proportion of the data is between 69 and 72 inches (taller than 69
but shorter or equal to 72)? A proportion is between 0 and 1.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{]}
\KeywordTok{mean}\NormalTok{(x }\OperatorTok{>}\StringTok{ }\DecValTok{69} \OperatorTok{&}\StringTok{ }\NormalTok{x }\OperatorTok{<=}\StringTok{ }\DecValTok{72}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3337438
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Suppose all you know about the height data from the previous exercise
  is the average and the standard deviation and that its distribution is
  approximated by the normal distribution.
\end{enumerate}

We can compute the average and standard deviation like this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(heights)}
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Male"}\NormalTok{]}
\NormalTok{avg <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x)}
\NormalTok{stdev <-}\StringTok{ }\KeywordTok{sd}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

Suppose you only have \texttt{avg} and \texttt{stdev} below, but no
access to \texttt{x}, can you approximate the proportion of the data
that is between 69 and 72 inches?

Given a normal distribution with a mean \texttt{mu} and standard
deviation \texttt{sigma}, you can calculate the proportion of
observations less than or equal to a certain \texttt{value} with
\texttt{pnorm(value,\ mu,\ sigma)}. Notice that this is the CDF for the
normal distribution. We will learn much more about \texttt{pnorm} later
in the course series, but you can also learn more now with
\texttt{?pnorm}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Male"}\NormalTok{]}
\NormalTok{avg <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x)}
\NormalTok{stdev <-}\StringTok{ }\KeywordTok{sd}\NormalTok{(x)}
\KeywordTok{pnorm}\NormalTok{(}\DecValTok{72}\NormalTok{, avg, stdev) }\OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{69}\NormalTok{, avg, stdev)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3061779
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Notice that the approximation calculated in the second question is
  very close to the exact calculation in the first question.
\end{enumerate}

The normal distribution was a useful approximation for this case.
However, the approximation is not always useful. An example is for the
more extreme values, often called the ``tails'' of the distribution.
Let's look at an example. We can compute the proportion of heights
between 79 and 81.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dslabs)  }
\KeywordTok{data}\NormalTok{(heights)}
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{]  }
\KeywordTok{mean}\NormalTok{(x }\OperatorTok{>}\StringTok{ }\DecValTok{79} \OperatorTok{&}\StringTok{ }\NormalTok{x }\OperatorTok{<=}\StringTok{ }\DecValTok{81}\NormalTok{)  }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{]}
\NormalTok{avg <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x)}
\NormalTok{stdev <-}\StringTok{ }\KeywordTok{sd}\NormalTok{(x)}
\NormalTok{exact <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x }\OperatorTok{>}\StringTok{ }\DecValTok{79} \OperatorTok{&}\StringTok{ }\NormalTok{x }\OperatorTok{<=}\StringTok{ }\DecValTok{81}\NormalTok{)}
\NormalTok{approx <-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{81}\NormalTok{, avg, stdev) }\OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{79}\NormalTok{, avg, stdev)}
\NormalTok{exact}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.004926108
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{approx}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.003051617
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{exact}\OperatorTok{/}\NormalTok{approx}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.614261
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Someone asks you what percent of seven footers are in the National
  Basketball Association (NBA). Can you provide an estimate? Let's try
  using the normal approximation to answer this question.
\end{enumerate}

First, we will estimate the proportion of adult men that are 7 feet tall
or taller.

Assume that the distribution of adult men in the world as normally
distributed with an average of 69 inches and a standard deviation of 3
inches.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# use pnorm to calculate the proportion over 7 feet (7*12 inches)}
\DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{7}\OperatorTok{*}\DecValTok{12}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.866516e-07
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Now we have an approximation for the proportion, call it \texttt{p},
  of men that are 7 feet tall or taller.
\end{enumerate}

We know that there are about 1 billion men between the ages of 18 and 40
in the world, the age range for the NBA.

Can we use the normal distribution to estimate how many of these 1
billion men are at least seven feet tall?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{7}\OperatorTok{*}\DecValTok{12}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\KeywordTok{round}\NormalTok{(p}\OperatorTok{*}\DecValTok{10}\OperatorTok{^}\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 287
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  There are about 10 National Basketball Association (NBA) players that
  are 7 feet tall or higher.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{7}\OperatorTok{*}\DecValTok{12}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{N <-}\StringTok{ }\KeywordTok{round}\NormalTok{(p}\OperatorTok{*}\DecValTok{10}\OperatorTok{^}\DecValTok{9}\NormalTok{)}
\DecValTok{10}\OperatorTok{/}\NormalTok{N}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.03484321
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  In the previous exerceise we estimated the proportion of seven footers
  in the NBA using this simple code:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{7}\OperatorTok{*}\DecValTok{12}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{3}\NormalTok{)  }
\NormalTok{N <-}\StringTok{ }\KeywordTok{round}\NormalTok{(p }\OperatorTok{*}\StringTok{ }\DecValTok{10}\OperatorTok{^}\DecValTok{9}\NormalTok{)  }
\DecValTok{10}\OperatorTok{/}\NormalTok{N  }
\end{Highlighting}
\end{Shaded}

Repeat the calculations performed in the previous question for Lebron
James' height: 6 feet 8 inches. There are about 150 players, instead of
10, that are at least that tall in the NBA.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## Change the solution to previous answer}
\NormalTok{p <-}\StringTok{ }\DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{7}\OperatorTok{*}\DecValTok{12}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{N <-}\StringTok{ }\KeywordTok{round}\NormalTok{(p }\OperatorTok{*}\StringTok{ }\DecValTok{10}\OperatorTok{^}\DecValTok{9}\NormalTok{)}
\DecValTok{10}\OperatorTok{/}\NormalTok{N}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.03484321
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{pnorm}\NormalTok{(}\DecValTok{6}\OperatorTok{*}\DecValTok{12}\OperatorTok{+}\DecValTok{8}\NormalTok{, }\DecValTok{69}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{N <-}\StringTok{ }\KeywordTok{round}\NormalTok{(p }\OperatorTok{*}\StringTok{ }\DecValTok{10}\OperatorTok{^}\DecValTok{9}\NormalTok{)}
\DecValTok{150}\OperatorTok{/}\NormalTok{N}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.001220842
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  In answering the previous questions, we found that it is not at all
  rare for a seven footer to become an NBA player.
\end{enumerate}

What would be a fair critique of our calculations?

\begin{itemize}
\tightlist
\item[$\square$]
  A. Practice and talent are what make a great basketball player, not
  height.
\item[$\square$]
  B. The normal approximation is not appropriate for heights.
\item[$\boxtimes$]
  C. As seen in exercise 3, the normal approximation tends to
  underestimate the extreme values. It's possible that there are more
  seven footers than we predicted.
\item[$\square$]
  D. As seen in exercise 3, the normal approximation tends to
  overestimate the extreme values. It's possible that there are less
  seven footers than we predicted.
\end{itemize}

\hypertarget{quantile-quantile-plots}{%
\subsection{Quantile-Quantile Plots}\label{quantile-quantile-plots}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#quantile-quantile-plots}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Quantile-quantile plots, or QQ-plots, are used to check whether
  distributions are well-approximated by a normal distribution.
\item
  Given a proportion \emph{p}, the quantile \emph{q} is the value such
  that the proportion of values in the data below \emph{q} is \emph{p}.
\item
  In a QQ-plot, the sample quantiles in the observed data are compared
  to the theoretical quantiles expected from the normal distribution. If
  the data are well-approximated by the normal distribution, then the
  points on the QQ-plot will fall near the identity line (sample =
  theoretical).
\item
  Calculate sample quantiles (observed quantiles) using the
  \texttt{quantile} function.
\item
  Calculate theoretical quantiles with the \texttt{qnorm} function.
  \texttt{qnorm} will calculate quantiles for the standard normal
  distribution (\(\mu = 0\), \(\sigma = 1\)) by default, but it can
  calculate quantiles for any normal distribution given mean and
  \texttt{sd} arguments. We will learn more about \texttt{qnorm} in the
  probability course.
\item
  Note that we will learn alternate ways to make QQ-plots with less code
  later in the series.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define x and z}
\NormalTok{index <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Male"}
\NormalTok{x <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[index]}
\NormalTok{z <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(x)}

\CommentTok{# proportion of data below 69.5}
\KeywordTok{mean}\NormalTok{(x }\OperatorTok{<=}\StringTok{ }\FloatTok{69.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5147783
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate observed and theoretical quantiles}
\NormalTok{p <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.05}\NormalTok{, }\FloatTok{0.95}\NormalTok{, }\FloatTok{0.05}\NormalTok{)}
\NormalTok{observed_quantiles <-}\StringTok{ }\KeywordTok{quantile}\NormalTok{(x, p)}
\NormalTok{theoretical_quantiles <-}\StringTok{ }\KeywordTok{qnorm}\NormalTok{(p, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(x), }\DataTypeTok{sd =} \KeywordTok{sd}\NormalTok{(x))}

\CommentTok{# make QQ-plot}
\KeywordTok{plot}\NormalTok{(theoretical_quantiles, observed_quantiles)}
\KeywordTok{abline}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-24-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# make QQ-plot with scaled values}
\NormalTok{observed_quantiles <-}\StringTok{ }\KeywordTok{quantile}\NormalTok{(z, p)}
\NormalTok{theoretical_quantiles <-}\StringTok{ }\KeywordTok{qnorm}\NormalTok{(p) }
\KeywordTok{plot}\NormalTok{(theoretical_quantiles, observed_quantiles)}
\KeywordTok{abline}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-24-2.pdf}

\hypertarget{percentiles}{%
\subsection{Percentiles}\label{percentiles}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#percentiles}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  \emph{Percentiles} are the quantiles obtained when defining \emph{p}
  as \texttt{0.01,0.02,...,0.99}. They summarize the values at which a
  certain percent of the observations are equal to or less than that
  value.
\item
  The 50th percentile is also known as the \emph{median}.
\item
  The \emph{quartiles} are the 25th, 50th and 75th percentiles.
\end{itemize}

\hypertarget{boxplots}{%
\subsection{Boxplots}\label{boxplots}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#boxplots}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  When data do not follow a normal distribution and cannot be succinctly
  summarized by only the mean and standard deviation, an alternative is
  to report a five-number summary: range (ignoring outliers) and the
  quartiles (25th, 50th, 75th percentile).
\item
  In a \emph{boxplot}, the box is defined by the 25th and 75th
  percentiles and the median is a horizontal line through the box. The
  whiskers show the range excluding outliers, and outliers are plotted
  separately as individual points.
\item
  The \emph{interquartile} range is the distance between the 25th and
  75th percentiles.
\item
  Boxplots are particularly useful when comparing multiple
  distributions.
\item
  We discuss outliers later.
\end{itemize}

\hypertarget{assessment---quantiles-percentiles-and-boxplots}{%
\subsection{Assessment - Quantiles, percentiles, and
boxplots}\label{assessment---quantiles-percentiles-and-boxplots}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  When analyzing data it's often important to know the number of
  measurements you have for each category.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{male <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Male"}\NormalTok{]}
\NormalTok{female <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Female"}\NormalTok{]}
\KeywordTok{length}\NormalTok{(male)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 812
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{length}\NormalTok{(female)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 238
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Suppose we can't make a plot and want to compare the distributions
  side by side. If the number of data points is large, listing all the
  numbers is inpractical. A more practical approach is to look at the
  percentiles. We can obtain percentiles using the \texttt{quantile}
  function like this
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(heights)}
\KeywordTok{quantile}\NormalTok{(heights}\OperatorTok{$}\NormalTok{height, }\KeywordTok{seq}\NormalTok{(.}\DecValTok{01}\NormalTok{, }\FloatTok{0.99}\NormalTok{, }\FloatTok{0.01}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{male <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Male"}\NormalTok{]}
\NormalTok{female <-}\StringTok{ }\NormalTok{heights}\OperatorTok{$}\NormalTok{height[heights}\OperatorTok{$}\NormalTok{sex}\OperatorTok{==}\StringTok{"Female"}\NormalTok{]}
\NormalTok{female_percentiles <-}\StringTok{ }\KeywordTok{quantile}\NormalTok{(female, }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.2}\NormalTok{))}
\NormalTok{male_percentiles <-}\StringTok{ }\KeywordTok{quantile}\NormalTok{(male, }\KeywordTok{seq}\NormalTok{(}\FloatTok{0.1}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.2}\NormalTok{))}
\NormalTok{df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{female =}\NormalTok{ (female_percentiles), }\DataTypeTok{male =}\NormalTok{ (male_percentiles))}
\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       female     male
## 10% 61.00000 65.00000
## 30% 63.00000 68.00000
## 50% 64.98031 69.00000
## 70% 66.46417 71.00000
## 90% 69.00000 73.22751
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Study the boxplots summarizing the distributions of populations sizes
  by country.
\end{enumerate}

\begin{figure}
\centering
\includegraphics{images/Continent vs Population.png}
\caption{Continent vs Population}
\end{figure}

Which continent has the country with the largest population size?

\begin{itemize}
\tightlist
\item[$\square$]
  A. Africa
\item[$\square$]
  B. Americas
\item[$\boxtimes$]
  C. Asia
\item[$\square$]
  D. Europe
\item[$\square$]
  E. Oceania
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Study the boxplots summarizing the distributions of populations sizes
  by country.
\end{enumerate}

Which continent has median country with the largest population?

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  A. Africa
\item[$\square$]
  B. Americas
\item[$\square$]
  C. Asia
\item[$\square$]
  D. Europe
\item[$\square$]
  E. Oceania
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Again, look at the boxplots summarizing the distributions of
  populations sizes by country.
\end{enumerate}

To the nearest million, what is the median population size for Africa?

\begin{itemize}
\tightlist
\item[$\square$]
  A. 100 million
\item[$\square$]
  B. 25 million
\item[$\boxtimes$]
  C. 10 million
\item[$\square$]
  D. 5 million
\item[$\square$]
  E. 1 million
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Examine the following boxplots and report approximately what
  proportion of countries in Europe have populations below 14 million?
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  A. 0.75
\item[$\square$]
  B. 0.50
\item[$\square$]
  C. 0.25
\item[$\square$]
  D. 0.01
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Based on the boxplot, if we use a log transformation, which continent
  shown below has the largest interquartile range?
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\square$]
  A. Africa
\item[$\boxtimes$]
  B. Americas
\item[$\square$]
  C. Asia
\item[$\square$]
  D. Europe
\item[$\square$]
  E. Oceania
\end{itemize}

\hypertarget{distribution-of-female-heights}{%
\subsection{Distribution of Female
Heights}\label{distribution-of-female-heights}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/distributions.html\#student-height-cont}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  If a distribution is not normal, it cannot be summarized with only the
  mean and standard deviation. Provide a histogram, smooth density or
  boxplot instead.
\item
  A plot can force us to see unexpected results that make us question
  the quality or implications of our data.
\end{itemize}

\hypertarget{assessment---robust-summaries-with-outliers}{%
\subsection{Assessment - Robust Summaries With
Outliers}\label{assessment---robust-summaries-with-outliers}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  For this chapter, we will use height data collected by Francis Galton
  for his genetics studies. Here we just use height of the children in
  the dataset:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(HistData)}
\KeywordTok{data}\NormalTok{(Galton)}
\NormalTok{x <-}\StringTok{ }\NormalTok{Galton}\OperatorTok{$}\NormalTok{child}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(HistData)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"HistData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: HistData
\end{verbatim}

\begin{verbatim}
## Warning: package 'HistData' was built under R version 4.0.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(HistData)}
\KeywordTok{data}\NormalTok{(Galton)}
\NormalTok{x <-}\StringTok{ }\NormalTok{Galton}\OperatorTok{$}\NormalTok{child}
\KeywordTok{mean}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 68.08847
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{median}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 68.2
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Now for the same data compute the standard deviation and the median
  absolute deviation (MAD).
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{Galton}\OperatorTok{$}\NormalTok{child}
\KeywordTok{sd}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.517941
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mad}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.9652
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  In the previous exercises we saw that the mean and median are very
  similar and so are the standard deviation and MAD. This is expected
  since the data is approximated by a normal distribution which has this
  property.
\end{enumerate}

Now suppose that suppose Galton made a mistake when entering the first
value, forgetting to use the decimal point. You can imitate this error
by typing:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(HistData)}
\KeywordTok{data}\NormalTok{(Galton)}
\NormalTok{x <-}\StringTok{ }\NormalTok{Galton}\OperatorTok{$}\NormalTok{child}
\NormalTok{x_with_error <-}\StringTok{ }\NormalTok{x}
\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

The data now has an outlier that the normal approximation does not
account for. Let's see how this affects the average.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{Galton}\OperatorTok{$}\NormalTok{child}
\NormalTok{x_with_error <-}\StringTok{ }\NormalTok{x}
\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\DecValTok{10}
\NormalTok{gem <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x)}
\NormalTok{gem_error <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(x_with_error)}
\NormalTok{gem_error }\OperatorTok{-}\StringTok{ }\NormalTok{gem}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5983836
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  In the previous exercise we saw how a simple mistake in 1 out of over
  900 observations can result in the average of our data increasing more
  than half an inch, which is a large difference in practical terms.
\end{enumerate}

Now let's explore the effect this outlier has on the standard deviation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x_with_error <-}\StringTok{ }\NormalTok{x}
\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\DecValTok{10}
\KeywordTok{sd}\NormalTok{(x_with_error)}\OperatorTok{-}\StringTok{ }\KeywordTok{sd}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 15.6746
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  In the previous exercises we saw how one mistake can have a
  substantial effect on the average and the standard deviation.
\end{enumerate}

Now we are going to see how the median and MAD are much more resistant
to outliers. For this reason we say that they are \emph{robust}
summaries.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x_with_error <-}\StringTok{ }\NormalTok{x}
\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\DecValTok{10}
\NormalTok{mediaan <-}\StringTok{ }\KeywordTok{median}\NormalTok{(x)}
\NormalTok{mediaan_error <-}\StringTok{ }\KeywordTok{median}\NormalTok{(x_with_error)}
\NormalTok{mediaan_error }\OperatorTok{-}\StringTok{ }\NormalTok{mediaan}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  We saw that the median barely changes. Now let's see how the MAD is
  affected.
\end{enumerate}

We saw that the median barely changes. Now let's see how the MAD is
affected.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x_with_error <-}\StringTok{ }\NormalTok{x}
\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{x_with_error[}\DecValTok{1}\NormalTok{]}\OperatorTok{*}\DecValTok{10}
\NormalTok{mad_normal <-}\StringTok{ }\KeywordTok{mad}\NormalTok{(x)}
\NormalTok{mad_error <-}\StringTok{ }\KeywordTok{mad}\NormalTok{(x_with_error)}
\NormalTok{mad_error }\OperatorTok{-}\StringTok{ }\NormalTok{mad_normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  How could you use exploratory data analysis to detect that an error
  was made?
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\square$]
  A. Since it is only one value out of many, we will not be able to
  detect this.
\item[$\square$]
  B. We would see an obvious shift in the distribution.
\item[$\boxtimes$]
  C. A boxplot, histogram, or qq-plot would reveal a clear outlier.
\item[$\square$]
  D. A scatter plot would show high levels of measurement error.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  We have seen how the average can be affected by outliers.
\end{enumerate}

But how large can this effect get? This of course depends on the size of
the outlier and the size of the dataset.

To see how outliers can affect the average of a dataset, let's write a
simple function that takes the size of the outlier as input and returns
the average.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{Galton}\OperatorTok{$}\NormalTok{child}
\NormalTok{error_avg <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(k)\{}
\NormalTok{x[}\DecValTok{1}\NormalTok{] =}\StringTok{ }\NormalTok{k}
\KeywordTok{mean}\NormalTok{(x)}
\NormalTok{\}}
\KeywordTok{error_avg}\NormalTok{(}\DecValTok{10000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 78.79784
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{error_avg}\NormalTok{(}\OperatorTok{-}\DecValTok{10000}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 57.24612
\end{verbatim}

\hypertarget{section-2-overview}{%
\subsection{Section 2 Overview}\label{section-2-overview}}

In Section 2, you will learn how to create data visualizations in R
using ggplot2.

After completing Section 2, you will:

\begin{itemize}
\tightlist
\item
  be able to use ggplot2 to create data visualizations in R.
\item
  be able to explain what the data component of a graph is.
\item
  be able to identify the geometry component of a graph and know when to
  use which type of geometry.
\item
  be able to explain what the aesthetic mapping component of a graph is.
\item
  be able to understand the scale component of a graph and select an
  appropriate scale component to use.
\end{itemize}

Note that it can be hard to memorize all of the functions and arguments
used by ggplot2, so we recommend that you have a
\href{https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf}{cheat
sheet} handy to help you remember the necessary commands.

\hypertarget{ggplot}{%
\subsection{ggplot}\label{ggplot}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/ggplot2.html}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Throughout the series, we will create plots with the \textbf{ggplot2}
  package. ggplot2 is part of the tidyverse, which you can load with
  \texttt{library(tidyverse)}.
\item
  Note that you can also load ggplot2 alone using the command
  \texttt{library(ggplot2)}, instead of loading the entire tidyverse.
\item
  ggplot2 uses a \emph{grammar of graphics} to break plots into building
  blocks that have intuitive syntax, making it easy to create relatively
  complex and aesthetically pleasing plots with relatively simple and
  readable code.
\item
  ggplot2 is designed to work exclusively with tidy data (rows are
  observations and columns are variables).
\end{itemize}

\hypertarget{graph-components}{%
\subsection{Graph Components}\label{graph-components}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/ggplot2.html\#the-components-of-a-graph}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Plots in ggplot2 consist of 3 main components:

  \begin{itemize}
  \tightlist
  \item
    Data: The dataset being summarized
  \item
    Geometry: The type of plot (scatterplot, boxplot, barplot,
    histogram, qqplot, smooth density, etc.)
  \item
    Aesthetic mapping: Variables mapped to visual cues, such as x-axis
    and y-axis values and color
  \end{itemize}
\item
  There are additional components:

  \begin{itemize}
  \tightlist
  \item
    Scale
  \item
    Labels, Title, Legend
  \item
    Theme/Style
  \end{itemize}
\end{itemize}

\hypertarget{creating-a-new-plot}{%
\subsection{Creating a New Plot}\label{creating-a-new-plot}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/ggplot2.html\#ggplot-objects}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  You can associate a dataset x with a ggplot object with any of the 3
  commands:

  \begin{itemize}
  \tightlist
  \item
    \texttt{ggplot(data\ =\ x)}
  \item
    \texttt{ggplot(x)}
  \item
    \texttt{x\ \%\textgreater{}\%\ ggplot()}
  \end{itemize}
\item
  You can assign a ggplot object to a variable. If the object is not
  assigned to a variable, it will automatically be displayed.
\item
  You can display a ggplot object assigned to a variable by printing
  that variable.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ murders)}

\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ murders)}
\KeywordTok{class}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "gg"     "ggplot"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(p)    }\CommentTok{# this is equivalent to simply typing p}
\end{Highlighting}
\end{Shaded}

The functions above render a plot, in this case a blank slate since no
geometry has been defined. The only style choice we see is a grey
background.

\hypertarget{layers}{%
\subsection{Layers}\label{layers}}

The textbook for this section is available:

\begin{itemize}
\tightlist
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#geometries}{Geometries}
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#aesthetic-mappings}{Aesthetic
  mappings}
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#layers}{Layers}
\end{itemize}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  In ggplot2, graphs are created by adding \emph{layers} to the ggplot
  object:
  \texttt{DATA\ \%\textgreater{}\%\ ggplot()\ +\ LAYER\_1\ +\ LAYER\_2\ +\ ...\ +\ LAYER\_N}
\item
  The \emph{geometry layer} defines the plot type and takes the format
  \texttt{geom\_X} where X is the plot type.
\item
  \emph{Aesthetic mappings} describe how properties of the data connect
  with features of the graph (axis position, color, size, etc.) Define
  aesthetic mappings with the \texttt{aes} function.
\item
  aes uses variable names from the object component (for example,
  \texttt{total} rather than \texttt{murders\$total}).
\item
  \texttt{geom\_point} creates a scatterplot and requires x and y
  aesthetic mappings.
\item
  \texttt{geom\_text} and \texttt{geom\_label} add text to a scatterplot
  and require x, y, and label aesthetic mappings.
\item
  To determine which aesthetic mappings are required for a geometry,
  read the help file for that geometry.
\item
  You can add layers with different aesthetic mappings to the same
  graph.
\end{itemize}

\emph{Code: Adding layers to a plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, }\DataTypeTok{y =}\NormalTok{ total))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-40-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add points layer to predefined ggplot object}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ murders)}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-40-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add text layer to scatterplot}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-40-3.pdf}

\emph{Code: Example of \textbf{aes} behavior}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# no error from this call}
\NormalTok{p_test <-}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# error - "abb" is not a globally defined variable and cannot be found outside of aes}
\NormalTok{p_test <-}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total), }\DataTypeTok{label =}\NormalTok{ abb)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tinkering}{%
\subsection{Tinkering}\label{tinkering}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/ggplot2.html\#tinkering-with-arguments}{here}
and
\href{https://rafalab.github.io/dsbook/ggplot2.html\#global-versus-local-aesthetic-mappings}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  You can modify arguments to geometry functions other than aes and the
  data. Additional arguments can be found in the documentation for each
  geometry.
\item
  These arguments are not aesthetic mappings: they affect all data
  points the same way.
\item
  \emph{Global aesthetic mappings} apply to all geometries and can be
  defined when you initially call \texttt{ggplot}. All the geometries
  added as layers will default to this mapping. Local aesthetic mappings
  add additional information or override the default mappings.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# change the size of the points}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total), }\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-43-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# move text labels slightly to the right}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total), }\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb), }\DataTypeTok{nudge_x =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-43-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# simplify code by adding global aesthetic}
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb))}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\DataTypeTok{nudge_x =} \FloatTok{1.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-43-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# local aesthetics override global aesthetics}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =} \DecValTok{10}\NormalTok{, }\DataTypeTok{y =} \DecValTok{800}\NormalTok{, }\DataTypeTok{label =} \StringTok{"Hello there!"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-43-4.pdf}

\hypertarget{scales-labels-and-colors}{%
\subsection{Scales, Labels, and Colors}\label{scales-labels-and-colors}}

The textbook for this section is available:

\begin{itemize}
\tightlist
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#scales}{Scales}
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#labels-and-titles}{Labels
  and titles}
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#categories-as-colors}{Categories
  as colors}
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#annotation-shapes-and-adjustments}{Annotation,
  shapes and adjustments}
\end{itemize}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Convert the x-axis to log scale with
  \texttt{scale\_x\_continuous(trans\ =\ "log10")} or
  \texttt{scale\_x\_log10}. Similar functions exist for the y-axis.
\item
  Add axis titles with \texttt{xlab} and \texttt{ylab} functions. Add a
  plot title with the \texttt{ggtitle} function.
\item
  Add a color mapping that colors points by a variable by defining the
  \texttt{col} argument within \texttt{aes}. To color all points the
  same way, define \texttt{col} outside of \texttt{aes}.
\item
  Add a line with the \texttt{geom\_abline} geometry.
  \texttt{geom\_abline} takes arguments \texttt{slope} (default = 1) and
  \texttt{intercept} (default = 0). Change the color with \texttt{col}
  or \texttt{color} and line type with \texttt{lty}.
\item
  Placing the line layer after the point layer will overlay the line on
  top of the points. To overlay points on the line, place the line layer
  before the point layer.
\item
  There are many additional ways to tweak your graph that can be found
  in the ggplot2 documentation, cheat sheet, or on the internet. For
  example, you can change the legend title with
  \texttt{scale\_color\_discrete}.
\end{itemize}

\emph{Code: Log-scale the x- and y-axis}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define p}
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb))}

\CommentTok{# log base 10 scale the x-axis and y-axis}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\DataTypeTok{nudge_x =} \FloatTok{0.05}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log10"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log10"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-44-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# efficient log scaling of the axes}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\DataTypeTok{nudge_x =} \FloatTok{0.075}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_y_log10}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-44-2.pdf}

\emph{Code: Add labels and title}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\DataTypeTok{nudge_x =} \FloatTok{0.075}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_y_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Population in millions (log scale)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Total number of murders (log scale)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"US Gun Murders in 2010"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-45-1.pdf}

\emph{Code: Change color of the points}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# redefine p to be everything except the points layer}
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\DataTypeTok{nudge_x =} \FloatTok{0.075}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_y_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Population in millions (log scale)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Total number of murders (log scale)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"US Gun Murders in 2010"}\NormalTok{)}

\CommentTok{# make all points blue}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{, }\DataTypeTok{color =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-46-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# color points by region}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ region), }\DataTypeTok{size =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-46-2.pdf}

\emph{Code: Add a line with average murder rate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define average murder rate}
\NormalTok{r <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{rate =} \KeywordTok{sum}\NormalTok{(total) }\OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(population) }\OperatorTok{*}\StringTok{ }\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{pull}\NormalTok{(rate)}
    
\CommentTok{# basic line with average murder rate for the country}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ region), }\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_abline}\NormalTok{(}\DataTypeTok{intercept =} \KeywordTok{log10}\NormalTok{(r))    }\CommentTok{# slope is default of 1}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-47-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# change line to dashed and dark grey, line under points}
\NormalTok{p }\OperatorTok{+}\StringTok{ }
\StringTok{    }\KeywordTok{geom_abline}\NormalTok{(}\DataTypeTok{intercept =} \KeywordTok{log10}\NormalTok{(r), }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ region), }\DataTypeTok{size =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-47-2.pdf}

\emph{Code: Change legend title}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{"Region"}\NormalTok{)    }\CommentTok{# capitalize legend title}
\end{Highlighting}
\end{Shaded}

\hypertarget{add-on-packages}{%
\subsection{Add-on Packages}\label{add-on-packages}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/ggplot2.html\#add-on-packages}{here}
and
\href{https://rafalab.github.io/dsbook/ggplot2.html\#putting-it-all-together}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  The style of a ggplot graph can be changed using the \texttt{theme}
  function.
\item
  The \textbf{ggthemes} package adds additional themes.
\item
  The \textbf{ggrepel} package includes a geometry that repels text
  labels, ensuring they do not overlap with each other:
  \texttt{geom\_text\_repel}.
\end{itemize}

\emph{Code: Adding themes}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(ggthemes)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggthemes"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggthemes
\end{verbatim}

\begin{verbatim}
## Warning: package 'ggthemes' was built under R version 4.0.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# theme used for graphs in the textbook and course}
\KeywordTok{ds_theme_set}\NormalTok{()}

\CommentTok{# themes from ggthemes}
\KeywordTok{library}\NormalTok{(ggthemes)}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_economist}\NormalTok{()    }\CommentTok{# style of the Economist magazine}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-49-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_fivethirtyeight}\NormalTok{()    }\CommentTok{# style of the FiveThirtyEight website}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-49-2.pdf}

\emph{Code: Putting it all together to assemble the plot}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(ggrepel)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"ggrepel"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggrepel
\end{verbatim}

\begin{verbatim}
## Warning: package 'ggrepel' was built under R version 4.0.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load libraries}
\KeywordTok{library}\NormalTok{(ggrepel)}

\CommentTok{# define the intercept}
\NormalTok{r <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{rate =} \KeywordTok{sum}\NormalTok{(total) }\OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(population) }\OperatorTok{*}\StringTok{ }\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\NormalTok{.}\OperatorTok{$}\NormalTok{rate}
    
\CommentTok{# make the plot, combining all elements}
\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population}\OperatorTok{/}\DecValTok{10}\OperatorTok{^}\DecValTok{6}\NormalTok{, total, }\DataTypeTok{label =}\NormalTok{ abb)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_abline}\NormalTok{(}\DataTypeTok{intercept =} \KeywordTok{log10}\NormalTok{(r), }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{color =} \StringTok{"darkgrey"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{col =}\NormalTok{ region), }\DataTypeTok{size =} \DecValTok{3}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text_repel}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_y_log10}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Population in millions (log scale)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Total number of murders (log scale)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"US Gun Murders in 2010"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_color_discrete}\NormalTok{(}\DataTypeTok{name =} \StringTok{"Region"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme_economist}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-50-1.pdf}

\hypertarget{other-examples}{%
\subsection{Other Examples}\label{other-examples}}

The textbook for this section is available:

\begin{itemize}
\tightlist
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#histograms-1}{Histograms}
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#density-plots}{Density
  plots}
\item
  \href{https://rafalab.github.io/dsbook/distributions.html\#qq-plots}{QQ-plots}
\item
  \href{https://rafalab.github.io/dsbook/ggplot2.html\#grids-of-plots}{Grids
  of plots}
\end{itemize}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  \texttt{geom\_histogram} creates a histogram. Use the
  \texttt{binwidth} argument to change the width of bins, the
  \texttt{fill} argument to change the bar fill color, and the
  \texttt{col} argument to change bar outline color.
\item
  \texttt{geom\_density} creates smooth density plots. Change the fill
  color of the plot with the \texttt{fill} argument.
\item
  \texttt{geom\_qq} creates a quantile-quantile plot. This geometry
  requires the \texttt{sample} argument. By default, the data are
  compared to a standard normal distribution with a mean of 0 and
  standard deviation of 1. This can be changed with the \texttt{dparams}
  argument, or the sample data can be scaled.
\item
  Plots can be arranged adjacent to each other using the
  \texttt{grid.arrange} function from the \texttt{gridExtra} package.
  First, create the plots and save them to objects (p1, p2, \ldots).
  Then pass the plot objects to \texttt{grid.arrange}.
\end{itemize}

\emph{Code: Histograms in ggplot2}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define p}
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ height))}
    
\CommentTok{# basic histograms}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-51-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-51-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# histogram with blue fill, black outline, labels and title}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{"Male heights in inches"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Histogram"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-51-3.pdf}

\emph{Code: Smooth density plots in ggplot2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-52-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{fill =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-52-2.pdf}

\emph{Code: Quantile-quantile plots in ggplot2}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# basic QQ-plot}
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =}\NormalTok{ height))}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_qq}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-53-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# QQ-plot against a normal distribution with same mean/sd as data}
\NormalTok{params <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(height), }\DataTypeTok{sd =} \KeywordTok{sd}\NormalTok{(height))}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_qq}\NormalTok{(}\DataTypeTok{dparams =}\NormalTok{ params) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_abline}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-53-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# QQ-plot of scaled data against the standard normal distribution}
\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{sample =} \KeywordTok{scale}\NormalTok{(height))) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_qq}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_abline}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-53-3.pdf}

\emph{Code: Grids of plots with the grid.extra package}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(gridExtra)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"gridExtra"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: gridExtra
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'gridExtra'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     combine
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define plots p1, p2, p3}
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ height))}
\NormalTok{p1 <-}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{)}
\NormalTok{p2 <-}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{2}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{)}
\NormalTok{p3 <-}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{3}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"blue"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{)}

\CommentTok{# arrange plots next to each other in 1 row, 3 columns}
\KeywordTok{library}\NormalTok{(gridExtra)}
\KeywordTok{grid.arrange}\NormalTok{(p1, p2, p3, }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-54-1.pdf}

\hypertarget{assessment---ggplot2}{%
\subsection{Assessment - ggplot2}\label{assessment---ggplot2}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Start by loading the dplyr and ggplot2 libraries as well as the
  \texttt{murders} data.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(murders)}
\end{Highlighting}
\end{Shaded}

Note that you can load both dplyr and ggplot2, as well as other
packages, by installing and loading the tidyverse package.

With ggplot2 plots can be saved as objects. For example we can associate
a dataset with a plot object like this

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ murders)}
\end{Highlighting}
\end{Shaded}

Because \texttt{data} is the first argument we don't need to spell it
out. So we can write this instead:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(murders)}
\end{Highlighting}
\end{Shaded}

or, if we load \texttt{dplyr}, we can use the pipe:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Remember the pipe sends the object on the left of
\texttt{\%\textgreater{}\%} to be the first argument for the function
the right of \texttt{\%\textgreater{}\%}.

Now let's get an introduction to \texttt{ggplot}.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(dplyr)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"dplyr"}\NormalTok{)}

\KeywordTok{library}\NormalTok{(dplyr)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(murders)}
\KeywordTok{class}\NormalTok{(p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "gg"     "ggplot"
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Remember that to print an object you can use the command
  \texttt{print} or simply type the object. For example, instead of
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\DecValTok{2}
\KeywordTok{print}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

you can simply type

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\DecValTok{2}
\NormalTok{x}
\end{Highlighting}
\end{Shaded}

Print the object \texttt{p} defined in exercise one

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(murders)}
\end{Highlighting}
\end{Shaded}

and describe what you see.

\begin{itemize}
\tightlist
\item[$\square$]
  A. Nothing happens.
\item[$\boxtimes$]
  B. A blank slate plot.
\item[$\square$]
  C. A scatter plot.
\item[$\square$]
  D. A histogram.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Now we are going to review the use of pipes by seeing how they can be
  used with \texttt{ggplot}.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define ggplot object called p like in the previous exercise but using a pipe }
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{()}
\NormalTok{p }\CommentTok{# a blank slate plot}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-63-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Now we are going to add layers and the corresponding aesthetic
  mappings. For the murders data, we plotted total murders versus
  population sizes in the videos.
\end{enumerate}

Explore the \texttt{murders} data frame to remind yourself of the names
for the two variables (total murders and population size) we want to
plot and select the correct answer.

\begin{itemize}
\tightlist
\item[$\square$]
  A. state and abb.
\item[$\square$]
  B. total\_murders and population\_size.
\item[$\boxtimes$]
  C. total and population.
\item[$\square$]
  D. murders and size.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  To create a scatter plot, we add a layer with the function
  \texttt{geom\_point}.
\end{enumerate}

The aesthetic mappings require us to define the x-axis and y-axis
variables respectively. So the code looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ , }\DataTypeTok{y =}\NormalTok{ )) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

except we have to fill in the blanks to define the two variables
\texttt{x} and \texttt{y}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## Fill in the blanks}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{population , }\DataTypeTok{y =}\NormalTok{total )) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-65-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Note that if we don't use argument names, we can obtain the same plot
  by making sure we enter the variable names in the desired order.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-66-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  If instead of points we want to add text, we can use the geom\_text()
  or geom\_label() geometries.
\end{enumerate}

However, note that the following code

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

will give us the error message:
\texttt{Error:\ geom\_label\ requires\ the\ following\ missing\ aesthetics:\ label}

Why is this?

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  A. We need to map a character to each point through the label argument
  in aes.
\item[$\square$]
  B. We need to let geom\_label know what character to use in the plot.
\item[$\square$]
  C. The geom\_label geometry does not require x-axis and y-axis values.
\item[$\square$]
  D. geom\_label is not a ggplot2 command.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  You can also add labels to the points on a plot.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## edit the next line to add the label}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-68-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  Now let's change the color of the labels to blue. How can we do this?
\end{enumerate}

\begin{itemize}
\tightlist
\item[$\square$]
  A. By adding a column called blue to murders
\item[$\square$]
  B. By mapping the colors through aes because each label needs a
  different color
\item[$\square$]
  C. By using the color argument in ggplot
\item[$\boxtimes$]
  D. By using the color argument in geom\_label because we want all
  colors to be blue so we do not need to map colors
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  Now let's go ahead and make the labels blue. We previously wrote this
  code to add labels to our plot:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label=}\NormalTok{ abb)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Now we will edit this code.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total,}\DataTypeTok{label=}\NormalTok{ abb)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{(}\DataTypeTok{color=}\StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-70-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{10}
\tightlist
\item
  Now suppose we want to use color to represent the different regions.
\end{enumerate}

So the states from the West will be one color, states from the Northeast
another, and so on.

In this case, which of the following is most appropriate:

\begin{itemize}
\tightlist
\item[$\square$]
  A. Adding a column called color to murders with the color we want to
  use
\item[$\boxtimes$]
  B. Mapping the colors through the color argument of aes because each
  label needs a different color
\item[$\square$]
  C. Using the color argument in ggplot
\item[$\square$]
  D. Using the color argument in geom\_label because we want all colors
  to be blue so we do not need to map colors
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{11}
\tightlist
\item
  We previously used this code to make a plot using the state
  abbreviations as labels:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

We are now going to add color to represent the region.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## edit this code}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb, }\DataTypeTok{color=}\NormalTok{region)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-72-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{12}
\tightlist
\item
  Now we are going to change the axes to log scales to account for the
  fact that the population distribution is skewed.
\end{enumerate}

Let's start by defining an object \texttt{p} that holds the plot we have
made up to now:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb, }\DataTypeTok{color =}\NormalTok{ region)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

To change the x-axis to a log scale we learned about the
\texttt{scale\_x\_log10()} function. We can change the axis by adding
this layer to the object \texttt{p} to change the scale and render the
plot using the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_x_log10}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb, }\DataTypeTok{color =}\NormalTok{ region)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_label}\NormalTok{()}
\CommentTok{## add layers to p here}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_y_log10}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-75-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{13}
\tightlist
\item
  In the previous exercises we created a plot using the following code:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(murders)}
\NormalTok{p<-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb, }\DataTypeTok{color =}\NormalTok{ region)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_label}\NormalTok{()}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_y_log10}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

We are now going to add a title to this plot. We will do this by adding
yet another layer, this time with the function \texttt{ggtitle}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(population, total, }\DataTypeTok{label =}\NormalTok{ abb, }\DataTypeTok{color =}\NormalTok{ region)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_label}\NormalTok{()}
\CommentTok{# add a layer to add title to the next line}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_x_log10}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_y_log10}\NormalTok{() }\OperatorTok{+}\StringTok{ }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Gun murder data"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-77-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{14}
\tightlist
\item
  We are going to shift our focus from the \texttt{murders} dataset to
  explore the \texttt{heights} dataset.
\end{enumerate}

We use the \texttt{geom\_histogram} function to make a histogram of the
heights in the \texttt{heights} data frame. When reading the
documentation for this function we see that it requires just one
mapping, the values to be used for the histogram.

What is the variable containing the heights in inches in the
\texttt{heights} data frame?

\begin{itemize}
\tightlist
\item[$\square$]
  A. sex
\item[$\square$]
  B. heights
\item[$\boxtimes$]
  C. height
\item[$\square$]
  D. heights\$height
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{15}
\tightlist
\item
  We are now going to make a histogram of the heights so we will load
  the heights dataset.
\end{enumerate}

The following code has been pre-run for you to load the heights dataset:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(heights)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define p here}
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height))}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{16}
\tightlist
\item
  Now we are ready to add a layer to actually make the histogram.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height))}
\CommentTok{## add a layer to p}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-80-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{17}
\tightlist
\item
  Note that when we run the code from the previous exercise we get the
  following warning:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{stat_bin}\NormalTok{() using bins =}\StringTok{ }\FloatTok{30.}\NormalTok{ Pick better value with binwidth.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height))}
\CommentTok{## add the geom_histogram layer but with the requested argument}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-82-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{18}
\tightlist
\item
  Now instead of a histogram we are going to make a smooth density plot.
\end{enumerate}

In this case, we will not make an object \texttt{p}. Instead we will
render the plot using a single line of code. In the previous exercise,
we could have created a histogram using one line of code like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_histogram}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## add the correct layer using +}
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-84-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{19}
\tightlist
\item
  Now we are going to make density plots for males and females
  separately.
\end{enumerate}

We can do this using the \texttt{group} argument within the \texttt{aes}
mapping. Because each point will be assigned to a different density
depending on a variable from the dataset, we need to map within
\texttt{aes}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## add the group argument then a layer with +}
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height, }\DataTypeTok{group =}\NormalTok{ sex)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-85-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{20}
\tightlist
\item
  In the previous exercise we made the two density plots, one for each
  sex, using:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height, }\DataTypeTok{group =}\NormalTok{ sex)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

We can also assign groups through the \texttt{color} or \texttt{fill}
argument. For example, if you type \texttt{color\ =\ sex} ggplot knows
you want a different color for each sex. So two densities must be drawn.
You can therefore skip the \texttt{group\ =\ sex} mapping. Using
\texttt{color} has the added benefit that it uses color to distinguish
the groups. Change the density plots from the previous exercise to add
color.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## edit the next line to use color instead of group then add a density layer}
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height, }\DataTypeTok{color =}\NormalTok{ sex)) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-87-1.pdf}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{21}
\tightlist
\item
  We can also assign groups using the \texttt{fill} argument.
\end{enumerate}

When using the \texttt{geom\_density} geometry, \texttt{color} creates a
colored line for the smooth density plot while \texttt{fill} colors in
the area under the curve.

We can see what this looks like by running the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height, }\DataTypeTok{fill =}\NormalTok{ sex)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

However, here the second density is drawn over the other. We can change
this by using something called \emph{alpha blending}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heights }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(height, }\DataTypeTok{fill =}\NormalTok{ sex)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{alpha=}\FloatTok{0.2}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-89-1.pdf}

\hypertarget{section-3-overview}{%
\subsection{Section 3 Overview}\label{section-3-overview}}

Section 3 introduces you to summarizing with dplyr.

After completing Section 3, you will:

\begin{itemize}
\tightlist
\item
  understand the importance of summarizing data in exploratory data
  analysis.
\item
  be able to use the ``summarize'' verb in dplyr to facilitate
  summarizing data.
\item
  be able to use the ``group\_by'' verb in dplyr to facilitate
  summarizing data.
\item
  be able to access values using the dot placeholder.
\item
  be able to use ``arrange'' to examine data after sorting.
\end{itemize}

\hypertarget{dplyr}{%
\subsection{dplyr}\label{dplyr}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/tidyverse.html\#summarizing-data}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  \texttt{summarize} from the dplyr/tidyverse package computes summary
  statistics from the data frame. It returns a data frame whose column
  names are defined within the function call.
\item
  \texttt{summarize} can compute any summary function that operates on
  vectors and returns a single value, but it cannot operate on functions
  that return multiple values.
\item
  Like most dplyr functions, \texttt{summarize} is aware of variable
  names within data frames and can use them directly.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compute average and standard deviation for males}
\NormalTok{s <-}\StringTok{ }\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(height), }\DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(height))}
    
\CommentTok{# access average and standard deviation from summary table}
\NormalTok{s}\OperatorTok{$}\NormalTok{average}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 69.31475
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s}\OperatorTok{$}\NormalTok{standard_deviation}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.611024
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compute median, min and max}
\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{median =} \KeywordTok{median}\NormalTok{(height),}
                       \DataTypeTok{minimum =} \KeywordTok{min}\NormalTok{(height),}
                       \DataTypeTok{maximum =} \KeywordTok{max}\NormalTok{(height))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   median minimum  maximum
## 1     69      50 82.67717
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# alternative way to get min, median, max in base R}
\KeywordTok{quantile}\NormalTok{(heights}\OperatorTok{$}\NormalTok{height, }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       0%      50%     100% 
## 50.00000 68.50000 82.67717
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# generates an error: summarize can only take functions that return a single value}
\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(sex }\OperatorTok{==}\StringTok{ "Male"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{range =} \KeywordTok{quantile}\NormalTok{(height, }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{the-dot-placeholder}{%
\subsection{The Dot Placeholder}\label{the-dot-placeholder}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/tidyverse.html\#the-dot-operator}{here}

Note that a common replacement for the dot operator is the pull
function. Here is the
\href{https://rafalab.github.io/dsbook/tidyverse.html\#pull}{textbook
section on the pull function}.

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  The dot operator allows you to access values stored in data that is
  being piped in using the \texttt{\%\textgreater{}\%} character. The
  dot is a placeholder for the data being passed in through the pipe.
\item
  The dot operator allows \texttt{dplyr} functions to return single
  vectors or numbers instead of only data frames.
\item
  \texttt{us\_murder\_rate\ \%\textgreater{}\%\ .\$rate} is equivalent
  to \texttt{us\_murder\_rate\$rate}.
\item
  Note that an equivalent way to extract a single column using the pipe
  is \texttt{us\_murder\_rate\ \%\textgreater{}\%\ pull(rate)}. The pull
  function will be used in later course material.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{murders <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{murder_rate =}\NormalTok{ total}\OperatorTok{/}\NormalTok{population}\OperatorTok{*}\DecValTok{100000}\NormalTok{)}
\KeywordTok{summarize}\NormalTok{(murders, }\KeywordTok{mean}\NormalTok{(murder_rate))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   mean(murder_rate)
## 1          2.779125
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate US murder rate, generating a data frame}
\NormalTok{us_murder_rate <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{rate =} \KeywordTok{sum}\NormalTok{(total) }\OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(population) }\OperatorTok{*}\StringTok{ }\DecValTok{100000}\NormalTok{)}
\NormalTok{us_murder_rate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       rate
## 1 3.034555
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# extract the numeric US murder rate with the dot operator}
\NormalTok{us_murder_rate }\OperatorTok{%>%}\StringTok{ }\NormalTok{.}\OperatorTok{$}\NormalTok{rate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.034555
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calculate and extract the murder rate with one pipe}
\NormalTok{us_murder_rate <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{rate =} \KeywordTok{sum}\NormalTok{(total) }\OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(population }\OperatorTok{*}\StringTok{ }\DecValTok{100000}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\NormalTok{.}\OperatorTok{$}\NormalTok{rate}
\end{Highlighting}
\end{Shaded}

\hypertarget{group-by}{%
\subsection{Group By}\label{group-by}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/tidyverse.html\#group-by}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  The \texttt{group\_by} function from \textbf{dplyr} converts a data
  frame to a grouped data frame, creating groups using one or more
  variables.
\item
  \texttt{summarize} and some other \textbf{dplyr} functions will behave
  differently on grouped data frames.
\item
  Using \texttt{summarize} on a grouped data frame computes the summary
  statistics for each of the separate groups.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compute separate average and standard deviation for male/female heights}
\NormalTok{heights }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(sex) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(height), }\DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(height))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{verbatim}
## # A tibble: 2 x 3
##   sex    average standard_deviation
##   <fct>    <dbl>              <dbl>
## 1 Female    64.9               3.76
## 2 Male      69.3               3.61
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compute median murder rate in 4 regions of country}
\NormalTok{murders <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{murder_rate =}\NormalTok{ total}\OperatorTok{/}\NormalTok{population }\OperatorTok{*}\StringTok{ }\DecValTok{100000}\NormalTok{)}
\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(region) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{median_rate =} \KeywordTok{median}\NormalTok{(murder_rate))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{verbatim}
## # A tibble: 4 x 2
##   region        median_rate
##   <fct>               <dbl>
## 1 Northeast            1.80
## 2 South                3.40
## 3 North Central        1.97
## 4 West                 1.29
\end{verbatim}

\hypertarget{sorting-data-tables}{%
\subsection{Sorting Data Tables}\label{sorting-data-tables}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/tidyverse.html\#sorting-data-frames}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  The \texttt{arrange} function from \textbf{dplyr} sorts a data frame
  by a given column.
\item
  By default, \texttt{arrange} sorts in ascending order (lowest to
  highest). To instead sort in descending order, use the function
  \texttt{desc} inside of \texttt{arrange}.
\item
  You can \texttt{arrange} by multiple levels: within equivalent values
  of the first level, observations are sorted by the second level, and
  so on.
\item
  The \texttt{top\_n} function shows the top results ranked by a given
  variable, but the results are not ordered. You can combine
  \texttt{top\_n} with \texttt{arrange} to return the top results in
  order.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# set up murders object}
\NormalTok{murders <-}\StringTok{ }\NormalTok{murders }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{murder_rate =}\NormalTok{ total}\OperatorTok{/}\NormalTok{population }\OperatorTok{*}\StringTok{ }\DecValTok{100000}\NormalTok{)}

\CommentTok{# arrange by population column, smallest to largest}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(population) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  state abb        region population total murder_rate
## 1              Wyoming  WY          West     563626     5   0.8871131
## 2 District of Columbia  DC         South     601723    99  16.4527532
## 3              Vermont  VT     Northeast     625741     2   0.3196211
## 4         North Dakota  ND North Central     672591     4   0.5947151
## 5               Alaska  AK          West     710231    19   2.6751860
## 6         South Dakota  SD North Central     814180     8   0.9825837
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# arrange by murder rate, smallest to largest}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(murder_rate) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           state abb        region population total murder_rate
## 1       Vermont  VT     Northeast     625741     2   0.3196211
## 2 New Hampshire  NH     Northeast    1316470     5   0.3798036
## 3        Hawaii  HI          West    1360301     7   0.5145920
## 4  North Dakota  ND North Central     672591     4   0.5947151
## 5          Iowa  IA North Central    3046355    21   0.6893484
## 6         Idaho  ID          West    1567582    12   0.7655102
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# arrange by murder rate in descending order}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(murder_rate)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  state abb        region population total murder_rate
## 1 District of Columbia  DC         South     601723    99   16.452753
## 2            Louisiana  LA         South    4533372   351    7.742581
## 3             Missouri  MO North Central    5988927   321    5.359892
## 4             Maryland  MD         South    5773552   293    5.074866
## 5       South Carolina  SC         South    4625364   207    4.475323
## 6             Delaware  DE         South     897934    38    4.231937
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# arrange by region alphabetically, then by murder rate within each region}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(region, murder_rate) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           state abb    region population total murder_rate
## 1       Vermont  VT Northeast     625741     2   0.3196211
## 2 New Hampshire  NH Northeast    1316470     5   0.3798036
## 3         Maine  ME Northeast    1328361    11   0.8280881
## 4  Rhode Island  RI Northeast    1052567    16   1.5200933
## 5 Massachusetts  MA Northeast    6547629   118   1.8021791
## 6      New York  NY Northeast   19378102   517   2.6679599
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# show the top 10 states with highest murder rate, not ordered by rate}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{top_n}\NormalTok{(}\DecValTok{10}\NormalTok{, murder_rate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                   state abb        region population total murder_rate
## 1               Arizona  AZ          West    6392017   232    3.629527
## 2              Delaware  DE         South     897934    38    4.231937
## 3  District of Columbia  DC         South     601723    99   16.452753
## 4               Georgia  GA         South    9920000   376    3.790323
## 5             Louisiana  LA         South    4533372   351    7.742581
## 6              Maryland  MD         South    5773552   293    5.074866
## 7              Michigan  MI North Central    9883640   413    4.178622
## 8           Mississippi  MS         South    2967297   120    4.044085
## 9              Missouri  MO North Central    5988927   321    5.359892
## 10       South Carolina  SC         South    4625364   207    4.475323
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# show the top 10 states with highest murder rate, ordered by rate}
\NormalTok{murders }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(murder_rate)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{top_n}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Selecting by murder_rate
\end{verbatim}

\begin{verbatim}
##                   state abb        region population total murder_rate
## 1  District of Columbia  DC         South     601723    99   16.452753
## 2             Louisiana  LA         South    4533372   351    7.742581
## 3              Missouri  MO North Central    5988927   321    5.359892
## 4              Maryland  MD         South    5773552   293    5.074866
## 5        South Carolina  SC         South    4625364   207    4.475323
## 6              Delaware  DE         South     897934    38    4.231937
## 7              Michigan  MI North Central    9883640   413    4.178622
## 8           Mississippi  MS         South    2967297   120    4.044085
## 9               Georgia  GA         South    9920000   376    3.790323
## 10              Arizona  AZ          West    6392017   232    3.629527
\end{verbatim}

\hypertarget{assessment---summarizing-with-dplyr}{%
\subsection{Assessment - Summarizing with
dplyr}\label{assessment---summarizing-with-dplyr}}

To practice our dplyr skills we will be working with data from the
survey collected by the United States National Center for Health
Statistics (NCHS). This center has conducted a series of health and
nutrition surveys since the 1960's.

Starting in 1999, about 5,000 individuals of all ages have been
interviewed every year and then they complete the health examination
component of the survey. Part of this dataset is made available via the
NHANES package which can be loaded this way:

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\OperatorTok{!}\KeywordTok{require}\NormalTok{(NHANES)) }\KeywordTok{install.packages}\NormalTok{(}\StringTok{"NHANES"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: NHANES
\end{verbatim}

\begin{verbatim}
## Warning: package 'NHANES' was built under R version 4.0.2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(NHANES)}
\KeywordTok{data}\NormalTok{(NHANES)}
\end{Highlighting}
\end{Shaded}

The NHANES data has many missing values. Remember that the main
summarization function in R will return \texttt{NA} if any of the
entries of the input vector is an \texttt{NA}. Here is an example:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{data}\NormalTok{(na_example)}
\KeywordTok{mean}\NormalTok{(na_example)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sd}\NormalTok{(na_example)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

To ignore the \texttt{NA}s, we can use the \texttt{na.rm} argument:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{mean}\NormalTok{(na_example, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.301754
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sd}\NormalTok{(na_example, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.22338
\end{verbatim}

Try running this code, then let us know you are ready to proceed with
the analysis.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Let's explore the \texttt{NHANES} data. We will be exploring blood
  pressure in this dataset.
\end{enumerate}

First let's select a group to set the standard. We will use 20-29 year
old females. Note that the category is coded with \texttt{20-29}, with a
space in front of the \texttt{20}! The \texttt{AgeDecade} is a
categorical variable with these ages.

To know if someone is female, you can look at the \texttt{Gender}
variable.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## fill in what is needed}
\NormalTok{tab <-}\StringTok{ }\NormalTok{NHANES }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(AgeDecade }\OperatorTok{==}\StringTok{ " 20-29"} \OperatorTok{&}\StringTok{ }\NormalTok{Gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{)}
\KeywordTok{head}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 76
##      ID SurveyYr Gender   Age AgeDecade AgeMonths Race1 Race3 Education
##   <int> <fct>    <fct>  <int> <fct>         <int> <fct> <fct> <fct>    
## 1 51710 2009_10  female    26 " 20-29"        319 White <NA>  College ~
## 2 51731 2009_10  female    28 " 20-29"        346 Black <NA>  High Sch~
## 3 51741 2009_10  female    21 " 20-29"        253 Black <NA>  Some Col~
## 4 51741 2009_10  female    21 " 20-29"        253 Black <NA>  Some Col~
## 5 51760 2009_10  female    27 " 20-29"        334 Hisp~ <NA>  9 - 11th~
## 6 51764 2009_10  female    29 " 20-29"        357 White <NA>  College ~
## # ... with 67 more variables: MaritalStatus <fct>, HHIncome <fct>,
## #   HHIncomeMid <int>, Poverty <dbl>, HomeRooms <int>, HomeOwn <fct>,
## #   Work <fct>, Weight <dbl>, Length <dbl>, HeadCirc <dbl>, Height <dbl>,
## #   BMI <dbl>, BMICatUnder20yrs <fct>, BMI_WHO <fct>, Pulse <int>,
## #   BPSysAve <int>, BPDiaAve <int>, BPSys1 <int>, BPDia1 <int>, BPSys2 <int>,
## #   BPDia2 <int>, BPSys3 <int>, BPDia3 <int>, Testosterone <dbl>,
## #   DirectChol <dbl>, TotChol <dbl>, UrineVol1 <int>, UrineFlow1 <dbl>,
## #   UrineVol2 <int>, UrineFlow2 <dbl>, Diabetes <fct>, DiabetesAge <int>,
## #   HealthGen <fct>, DaysPhysHlthBad <int>, DaysMentHlthBad <int>,
## #   LittleInterest <fct>, Depressed <fct>, nPregnancies <int>, nBabies <int>,
## #   Age1stBaby <int>, SleepHrsNight <int>, SleepTrouble <fct>,
## #   PhysActive <fct>, PhysActiveDays <int>, TVHrsDay <fct>, CompHrsDay <fct>,
## #   TVHrsDayChild <int>, CompHrsDayChild <int>, Alcohol12PlusYr <fct>,
## #   AlcoholDay <int>, AlcoholYear <int>, SmokeNow <fct>, Smoke100 <fct>,
## #   Smoke100n <fct>, SmokeAge <int>, Marijuana <fct>, AgeFirstMarij <int>,
## #   RegularMarij <fct>, AgeRegMarij <int>, HardDrugs <fct>, SexEver <fct>,
## #   SexAge <int>, SexNumPartnLife <int>, SexNumPartYear <int>, SameSex <fct>,
## #   SexOrientation <fct>, PregnantNow <fct>
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Now we will compute the average and standard deviation for the
  subgroup we defined in the previous exercise (20-29 year old females),
  which we will use reference for what is typical.
\end{enumerate}

You will determine the average and standard deviation of systolic blood
pressure, which are stored in the \texttt{BPSysAve} variable in the
NHANES dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## complete this line of code.}
\NormalTok{ref <-}\StringTok{ }\NormalTok{NHANES }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(AgeDecade }\OperatorTok{==}\StringTok{ " 20-29"} \OperatorTok{&}\StringTok{ }\NormalTok{Gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }\DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{ref}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   average standard_deviation
##     <dbl>              <dbl>
## 1    108.               10.1
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Now we will repeat the exercise and generate only the average blood
  pressure for 20-29 year old females.
\end{enumerate}

For this exercise, you should review how to use the place holder
\texttt{.} in dplyr or the \texttt{pull} function.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## modify the code we wrote for previous exercise.}
\NormalTok{ref_avg <-}\StringTok{ }\NormalTok{NHANES }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(AgeDecade }\OperatorTok{==}\StringTok{ " 20-29"} \OperatorTok{&}\StringTok{ }\NormalTok{Gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
            \DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\NormalTok{.}\OperatorTok{$}\NormalTok{average}
\NormalTok{ref_avg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 108.4224
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Let's continue practicing by calculating two other data summaries: the
  minimum and the maximum.
\end{enumerate}

Again we will do it for the \texttt{BPSysAve} variable and the group of
20-29 year old females.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## complete the line}
\NormalTok{NHANES }\OperatorTok{%>%}
\StringTok{      }\KeywordTok{filter}\NormalTok{(AgeDecade }\OperatorTok{==}\StringTok{ " 20-29"}  \OperatorTok{&}\StringTok{ }\NormalTok{Gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{minbp =} \KeywordTok{min}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
            \DataTypeTok{maxbp =} \KeywordTok{max}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   minbp maxbp
##   <int> <int>
## 1    84   179
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Now let's practice using the \texttt{group\_by} function.
\end{enumerate}

What we are about to do is a very common operation in data science: you
will split a data table into groups and then compute summary statistics
for each group.

We will compute the average and standard deviation of systolic blood
pressure for females for each age group separately. Remember that the
age groups are contained in \texttt{AgeDecade}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{##complete the line with group_by and summarize}
\NormalTok{NHANES }\OperatorTok{%>%}
\StringTok{      }\KeywordTok{filter}\NormalTok{(Gender }\OperatorTok{==}\StringTok{ "female"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(AgeDecade) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
            \DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{verbatim}
## # A tibble: 9 x 3
##   AgeDecade average standard_deviation
##   <fct>       <dbl>              <dbl>
## 1 " 0-9"       100.               9.07
## 2 " 10-19"     104.               9.46
## 3 " 20-29"     108.              10.1 
## 4 " 30-39"     111.              12.3 
## 5 " 40-49"     115.              14.5 
## 6 " 50-59"     122.              16.2 
## 7 " 60-69"     127.              17.1 
## 8 " 70+"       134.              19.8 
## 9  <NA>        142.              22.9
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Now let's practice using \texttt{group\_by} some more.
\end{enumerate}

We are going to repeat the previous exercise of calculating the average
and standard deviation of systolic blood pressure, but for males instead
of females.

This time we will not provide much sample code. You are on your own!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NHANES }\OperatorTok{%>%}
\StringTok{      }\KeywordTok{filter}\NormalTok{(Gender }\OperatorTok{==}\StringTok{ "male"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(AgeDecade) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
            \DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{verbatim}
## # A tibble: 9 x 3
##   AgeDecade average standard_deviation
##   <fct>       <dbl>              <dbl>
## 1 " 0-9"       97.4               8.32
## 2 " 10-19"    110.               11.2 
## 3 " 20-29"    118.               11.3 
## 4 " 30-39"    119.               12.3 
## 5 " 40-49"    121.               14.0 
## 6 " 50-59"    126.               17.8 
## 7 " 60-69"    127.               17.5 
## 8 " 70+"      130.               18.7 
## 9  <NA>       136.               23.5
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  We can actually combine both of these summaries into a single line of
  code.
\end{enumerate}

This is because \texttt{group\_by} permits us to group by more than one
variable.

We can use \texttt{group\_by(AgeDecade,\ Gender)} to group by both age
decades and gender.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NHANES }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(AgeDecade, Gender) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }
            \DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` regrouping output by 'AgeDecade' (override with `.groups` argument)
\end{verbatim}

\begin{verbatim}
## # A tibble: 18 x 4
## # Groups:   AgeDecade [9]
##    AgeDecade Gender average standard_deviation
##    <fct>     <fct>    <dbl>              <dbl>
##  1 " 0-9"    female   100.                9.07
##  2 " 0-9"    male      97.4               8.32
##  3 " 10-19"  female   104.                9.46
##  4 " 10-19"  male     110.               11.2 
##  5 " 20-29"  female   108.               10.1 
##  6 " 20-29"  male     118.               11.3 
##  7 " 30-39"  female   111.               12.3 
##  8 " 30-39"  male     119.               12.3 
##  9 " 40-49"  female   115.               14.5 
## 10 " 40-49"  male     121.               14.0 
## 11 " 50-59"  female   122.               16.2 
## 12 " 50-59"  male     126.               17.8 
## 13 " 60-69"  female   127.               17.1 
## 14 " 60-69"  male     127.               17.5 
## 15 " 70+"    female   134.               19.8 
## 16 " 70+"    male     130.               18.7 
## 17  <NA>     female   142.               22.9 
## 18  <NA>     male     136.               23.5
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Now we are going to explore differences in systolic blood pressure
  across races, as reported in the \texttt{Race1} variable.
\end{enumerate}

We will learn to use the \texttt{arrange} function to order the outcome
acording to one variable.

Note that this function can be used to order any table by a given
outcome. Here is an example that arranges by systolic blood pressure.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NHANES }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(BPSysAve)}
\end{Highlighting}
\end{Shaded}

If we want it in descending order we can use the \texttt{desc} function
like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NHANES }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(}\KeywordTok{desc}\NormalTok{(BPSysAve))}
\end{Highlighting}
\end{Shaded}

In this example, we will compare systolic blood pressure across values
of the \texttt{Race1} variable for males between the ages of 40-49.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{NHANES }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(AgeDecade }\OperatorTok{==}\StringTok{ " 40-49"} \OperatorTok{&}\StringTok{ }\NormalTok{Gender }\OperatorTok{==}\StringTok{ "male"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(Race1) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{average =} \KeywordTok{mean}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{), }\DataTypeTok{standard_deviation =} \KeywordTok{sd}\NormalTok{(BPSysAve, }\DataTypeTok{na.rm=}\OtherTok{TRUE}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(average)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{verbatim}
## # A tibble: 5 x 3
##   Race1    average standard_deviation
##   <fct>      <dbl>              <dbl>
## 1 White       120.               13.4
## 2 Other       120.               16.2
## 3 Hispanic    122.               11.1
## 4 Mexican     122.               13.9
## 5 Black       126.               17.1
\end{verbatim}

\hypertarget{section-4-overview}{%
\subsection{Section 4 Overview}\label{section-4-overview}}

In Section 4, you will look at a case study involving data from the
\href{https://www.gapminder.org}{Gapminder Foundation} about trends in
world health and economics.

After completing Section 4, you will:

\begin{itemize}
\tightlist
\item
  understand how Hans Rosling and the Gapminder Foundation use effective
  data visualization to convey data-based trends.
\item
  be able to apply the ggplot2 techniques from the previous section to
  answer questions using data.
\item
  understand how fixed scales across plots can ease comparisons.
\item
  be able to modify graphs to improve data visualization.
\end{itemize}

\hypertarget{case-study-trends-in-world-health-and-economics}{%
\subsection{Case Study: Trends in World Health and
Economics}\label{case-study-trends-in-world-health-and-economics}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#case-study-new-insights-on-poverty}{here}

\textbf{More about Gapminder}

The original Gapminder TED talks are available and we encourage you to
watch them.

\begin{itemize}
\tightlist
\item
  \href{https://www.ted.com/talks/hans_rosling_the_best_stats_you_ve_ever_seen?language=en}{The
  Best Stats You've Ever Seen}
\item
  \href{https://www.ted.com/talks/hans_rosling_new_insights_on_poverty?language=en}{New
  Insights on Poverty}
\end{itemize}

You can also find more information and raw data (in addition to what we
analyze in class) \href{https://www.gapminder.org/}{at}.

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Data visualization can be used to dispel common myths and educate the
  public and contradict sensationalist or outdated claims and stories.
\item
  We will use real data to answer the following questions about world
  health and economics:

  \begin{itemize}
  \tightlist
  \item
    Is it still fair to consider the world as divided into the West and
    the developing world?
  \item
    Has income inequality across countries worsened over the last 40
    years?
  \end{itemize}
\end{itemize}

\hypertarget{gapminder-dataset}{%
\subsection{Gapminder Dataset}\label{gapminder-dataset}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#case-study-new-insights-on-poverty}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  A selection of world health and economics statistics from the
  Gapminder project can be found in the \textbf{dslabs} package as
  \texttt{data(gapminder)}.
\item
  Most people have misconceptions about world health and economics,
  which can be addressed by considering real data.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load and inspect gapminder data}
\KeywordTok{data}\NormalTok{(gapminder)}
\KeywordTok{head}\NormalTok{(gapminder)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               country year infant_mortality life_expectancy fertility
## 1             Albania 1960           115.40           62.87      6.19
## 2             Algeria 1960           148.20           47.50      7.65
## 3              Angola 1960           208.00           35.98      7.32
## 4 Antigua and Barbuda 1960               NA           62.97      4.43
## 5           Argentina 1960            59.87           65.39      3.11
## 6             Armenia 1960               NA           66.86      4.55
##   population          gdp continent          region
## 1    1636054           NA    Europe Southern Europe
## 2   11124892  13828152297    Africa Northern Africa
## 3    5270844           NA    Africa   Middle Africa
## 4      54681           NA  Americas       Caribbean
## 5   20619075 108322326649  Americas   South America
## 6    1867396           NA      Asia    Western Asia
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# compare infant mortality in Sri Lanka and Turkey}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\DecValTok{2015} \OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Sri Lanka"}\NormalTok{, }\StringTok{"Turkey"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{select}\NormalTok{(country, infant_mortality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     country infant_mortality
## 1 Sri Lanka              8.4
## 2    Turkey             11.6
\end{verbatim}

\hypertarget{life-expectancy-and-fertility-rates}{%
\subsection{Life Expectancy and Fertility
Rates}\label{life-expectancy-and-fertility-rates}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#scatterplots}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  A prevalent worldview is that the world is divided into two groups of
  countries:

  \begin{itemize}
  \tightlist
  \item
    Western world: high life expectancy, low fertility rate
  \item
    Developing world: lower life expectancy, higher fertility rate
  \end{itemize}
\item
  Gapminder data can be used to evaluate the validity of this view.
\item
  A scatterplot of life expectancy versus fertility rate in 1962
  suggests that this viewpoint was grounded in reality 50 years ago. Is
  it still the case today?
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# basic scatterplot of life expectancy versus fertility}
\KeywordTok{ds_theme_set}\NormalTok{()    }\CommentTok{# set plot theme}
\KeywordTok{filter}\NormalTok{(gapminder, year }\OperatorTok{==}\StringTok{ }\DecValTok{1962}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(fertility, life_expectancy)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-109-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add color as continent}
\KeywordTok{filter}\NormalTok{(gapminder, year }\OperatorTok{==}\StringTok{ }\DecValTok{1962}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(fertility, life_expectancy, }\DataTypeTok{color =}\NormalTok{ continent)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-109-2.pdf}

\hypertarget{faceting}{%
\subsection{Faceting}\label{faceting}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#faceting}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Faceting makes multiple side-by-side plots stratified by some
  variable. This is a way to ease comparisons.
\item
  The \texttt{facet\_grid} function allows faceting by up to two
  variables, with rows faceted by one variable and columns faceted by
  the other variable. To facet by only one variable, use the dot
  operator as the other variable.
\item
  The \texttt{facet\_wrap} function facets by one variable and
  automatically wraps the series of plots so they have readable
  dimensions.
\item
  Faceting keeps the axes fixed across all plots, easing comparisons
  between plots.
\item
  The data suggest that the developing versus Western world view no
  longer makes sense in 2012.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# facet by continent and year}
\KeywordTok{filter}\NormalTok{(gapminder, year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1962}\NormalTok{, }\DecValTok{2012}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(fertility, life_expectancy, }\DataTypeTok{col =}\NormalTok{ continent)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(continent }\OperatorTok{~}\StringTok{ }\NormalTok{year)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-110-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# facet by year only}
\KeywordTok{filter}\NormalTok{(gapminder, year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1962}\NormalTok{, }\DecValTok{2012}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(fertility, life_expectancy, }\DataTypeTok{col =}\NormalTok{ continent)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(. }\OperatorTok{~}\StringTok{ }\NormalTok{year)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-110-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# facet by year, plots wrapped onto multiple rows}
\NormalTok{years <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{1962}\NormalTok{, }\DecValTok{1980}\NormalTok{, }\DecValTok{1990}\NormalTok{, }\DecValTok{2000}\NormalTok{, }\DecValTok{2012}\NormalTok{)}
\NormalTok{continents <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Europe"}\NormalTok{, }\StringTok{"Asia"}\NormalTok{)}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\NormalTok{years }\OperatorTok{&}\StringTok{ }\NormalTok{continent }\OperatorTok{%in%}\StringTok{ }\NormalTok{continents) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(fertility, life_expectancy, }\DataTypeTok{col =}\NormalTok{ continent)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_wrap}\NormalTok{(}\OperatorTok{~}\NormalTok{year)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-110-3.pdf}

\hypertarget{time-series-plots}{%
\subsection{Time Series Plots}\label{time-series-plots}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#time-series-plots}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Time series plots have time on the x-axis and a variable of interest
  on the y-axis.
\item
  The \texttt{geom\_line} geometry connects adjacent data points to form
  a continuous line. A line plot is appropriate when points are
  regularly spaced, densely packed and from a single data series.
\item
  You can plot multiple lines on the same graph. Remember to group or
  color by a variable so that the lines are plotted independently.
\item
  Labeling is usually preferred over legends. However, legends are
  easier to make and appear by default. Add a label with
  \texttt{geom\_text}, specifying the coordinates where the label should
  appear on the graph.
\end{itemize}

\emph{Code: Single time series}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# scatterplot of US fertility by year}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "United States"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, fertility)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 rows containing missing values (geom_point).
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-111-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# line plot of US fertility by year}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{==}\StringTok{ "United States"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, fertility)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row(s) containing missing values (geom_path).
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-111-2.pdf}

\emph{Code: Multiple time series}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# line plot fertility time series for two countries- only one line (incorrect)}
\NormalTok{countries <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"South Korea"}\NormalTok{, }\StringTok{"Germany"}\NormalTok{)}
\NormalTok{gapminder }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{%in%}\StringTok{ }\NormalTok{countries) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, fertility)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 2 row(s) containing missing values (geom_path).
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-112-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# line plot fertility time series for two countries - one line per country}
\NormalTok{gapminder }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{%in%}\StringTok{ }\NormalTok{countries) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, fertility, }\DataTypeTok{group =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 2 row(s) containing missing values (geom_path).
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-112-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# fertility time series for two countries - lines colored by country}
\NormalTok{gapminder }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{%in%}\StringTok{ }\NormalTok{countries) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, fertility, }\DataTypeTok{col =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 2 row(s) containing missing values (geom_path).
\end{verbatim}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-112-3.pdf}

\emph{Code: Adding text labels to a plot}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# life expectancy time series - lines colored by country and labeled, no legend}
\NormalTok{labels <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{country =}\NormalTok{ countries, }\DataTypeTok{x =} \KeywordTok{c}\NormalTok{(}\DecValTok{1975}\NormalTok{, }\DecValTok{1965}\NormalTok{), }\DataTypeTok{y =} \KeywordTok{c}\NormalTok{(}\DecValTok{60}\NormalTok{, }\DecValTok{72}\NormalTok{))}
\NormalTok{gapminder }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(country }\OperatorTok{%in%}\StringTok{ }\NormalTok{countries) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, life_expectancy, }\DataTypeTok{col =}\NormalTok{ country)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_text}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ labels, }\KeywordTok{aes}\NormalTok{(x, y, }\DataTypeTok{label =}\NormalTok{ country), }\DataTypeTok{size =} \DecValTok{5}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{legend.position =} \StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-113-1.pdf}

\hypertarget{transformations}{%
\subsection{Transformations}\label{transformations}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#data-transformations}{here}
and
{[}here(\url{https://rafalab.github.io/dsbook/gapminder.html\#visualizing-multimodal-distributions})

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  We use GDP data to compute income in US dollars per day, adjusted for
  inflation.
\item
  Log transformations convert multiplicative changes into additive
  changes.
\item
  Common transformations are the log base 2 transformation and the log
  base 10 transformation. The choice of base depends on the range of the
  data. The natural log is not recommended for visualization because it
  is difficult to interpret.
\item
  The mode of a distribution is the value with the highest frequency.
  The mode of a normal distribution is the average. A distribution can
  have multiple local modes.
\item
  There are two ways to use log transformations in plots: transform the
  data before plotting or transform the axes of the plot. Log scales
  have the advantage of showing the original values as axis labels,
  while log transformed values ease interpretation of intermediate
  values between labels.
\item
  Scale the x-axis using \texttt{scale\_x\_continuous} or
  \texttt{scale\_x\_log10} layers in ggplot2. Similar functions exist
  for the y-axis.
\item
  In 1970, income distribution is bimodal, consistent with the
  dichotomous Western versus developing worldview.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add dollars per day variable}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dollars_per_day =}\NormalTok{ gdp}\OperatorTok{/}\NormalTok{population}\OperatorTok{/}\DecValTok{365}\NormalTok{)}

\CommentTok{# histogram of dollars per day}
\NormalTok{past_year <-}\StringTok{ }\DecValTok{1970}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-114-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# repeat histogram with log2 scaled data}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\KeywordTok{log2}\NormalTok{(dollars_per_day))) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-114-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# repeat histogram with log2 scaled x-axis}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-114-3.pdf}

\hypertarget{stratify-and-boxplot}{%
\subsection{Stratify and Boxplot}\label{stratify-and-boxplot}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#comparing-multiple-distributions-with-boxplots-and-ridge-plots}{here}.
Note that many boxplots from the video are instead dot plots in the
textbook and that a different boxplot is constructed in the textbook.
Also read that section to see an example of grouping factors with the
\texttt{case\_when} function.

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Make boxplots stratified by a categorical variable using the
  \texttt{geom\_boxplot} geometry.
\item
  Rotate axis labels by changing the theme through
  \texttt{element\_text}. You can change the angle and justification of
  the text labels.
\item
  Consider ordering your factors by a meaningful value with the
  \texttt{reorder} function, which changes the order of factor levels
  based on a related numeric vector. This is a way to ease comparisons.
\item
  Show the data by adding data points to the boxplot with a
  \texttt{geom\_point} layer. This adds information beyond the
  five-number summary to your plot, but too many data points it can
  obfuscate your message.
\end{itemize}

\emph{Code: Boxplot of GDP by region}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add dollars per day variable}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dollars_per_day =}\NormalTok{ gdp}\OperatorTok{/}\NormalTok{population}\OperatorTok{/}\DecValTok{365}\NormalTok{)}

\CommentTok{# number of regions}
\KeywordTok{length}\NormalTok{(}\KeywordTok{levels}\NormalTok{(gapminder}\OperatorTok{$}\NormalTok{region))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# boxplot of GDP by region in 1970}
\NormalTok{past_year <-}\StringTok{ }\DecValTok{1970}
\NormalTok{p <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(region, dollars_per_day))}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-115-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# rotate names on x-axis}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-115-2.pdf}

\emph{Code: The reorder function}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# by default, factor order is alphabetical}
\NormalTok{fac <-}\StringTok{ }\KeywordTok{factor}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"Asia"}\NormalTok{, }\StringTok{"Asia"}\NormalTok{, }\StringTok{"West"}\NormalTok{, }\StringTok{"West"}\NormalTok{, }\StringTok{"West"}\NormalTok{))}
\KeywordTok{levels}\NormalTok{(fac)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Asia" "West"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# reorder factor by the category means}
\NormalTok{value <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{11}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\NormalTok{fac <-}\StringTok{ }\KeywordTok{reorder}\NormalTok{(fac, value, }\DataTypeTok{FUN =}\NormalTok{ mean)}
\KeywordTok{levels}\NormalTok{(fac)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "West" "Asia"
\end{verbatim}

\emph{Code: Enhanced boxplot ordered by median income, scaled, and
showing data}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# reorder by median income and color by continent}
\NormalTok{p <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{region =} \KeywordTok{reorder}\NormalTok{(region, dollars_per_day, }\DataTypeTok{FUN =}\NormalTok{ median)) }\OperatorTok{%>%}\StringTok{    }\CommentTok{# reorder}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(region, dollars_per_day, }\DataTypeTok{fill =}\NormalTok{ continent)) }\OperatorTok{+}\StringTok{    }\CommentTok{# color by continent}
\StringTok{    }\KeywordTok{geom_boxplot}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{)}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-117-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# log2 scale y-axis}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-117-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add data points}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{show.legend =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-117-3.pdf}

\hypertarget{comparing-distributions}{%
\subsection{Comparing Distributions}\label{comparing-distributions}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#example-1970-versus-2010-income-distributions}{here}.
Note that the boxplots are slightly different.

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Use \texttt{intersect} to find the overlap between two vectors.
\item
  To make boxplots where grouped variables are adjacaent, color the
  boxplot by a factor instead of faceting by that factor. This is a way
  to ease comparisons.
\item
  The data suggest that the income gap between rich and poor countries
  has narrowed, not expanded.
\end{itemize}

\emph{Code: Histogram of income in West versus developing world, 1970
and 2010}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add dollars per day variable and define past year}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{dollars_per_day =}\NormalTok{ gdp}\OperatorTok{/}\NormalTok{population}\OperatorTok{/}\DecValTok{365}\NormalTok{)}
\NormalTok{past_year <-}\StringTok{ }\DecValTok{1970}

\CommentTok{# define Western countries}
\NormalTok{west <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Western Europe"}\NormalTok{, }\StringTok{"Northern Europe"}\NormalTok{, }\StringTok{"Southern Europe"}\NormalTok{, }\StringTok{"Northern America"}\NormalTok{, }\StringTok{"Australia and New Zealand"}\NormalTok{)}

\CommentTok{# facet by West vs devloping}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{ifelse}\NormalTok{(region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west, }\StringTok{"West"}\NormalTok{, }\StringTok{"Developing"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(. }\OperatorTok{~}\StringTok{ }\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-118-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# facet by West/developing and year}
\NormalTok{present_year <-}\StringTok{ }\DecValTok{2010}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(past_year, present_year) }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{ifelse}\NormalTok{(region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west, }\StringTok{"West"}\NormalTok{, }\StringTok{"Developing"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(year }\OperatorTok{~}\StringTok{ }\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-118-2.pdf}

\emph{Code: Income distribution of West versus developing world, only
countries with data}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# define countries that have data available in both years}
\NormalTok{country_list_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(dollars_per_day)) }\OperatorTok{%>%}\StringTok{ }\NormalTok{.}\OperatorTok{$}\NormalTok{country}
\NormalTok{country_list_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{present_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(dollars_per_day)) }\OperatorTok{%>%}\StringTok{ }\NormalTok{.}\OperatorTok{$}\NormalTok{country}
\NormalTok{country_list <-}\StringTok{ }\KeywordTok{intersect}\NormalTok{(country_list_}\DecValTok{1}\NormalTok{, country_list_}\DecValTok{2}\NormalTok{)}

\CommentTok{# make histogram including only countries with data available in both years}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(past_year, present_year) }\OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\NormalTok{country_list) }\OperatorTok{%>%}\StringTok{    }\CommentTok{# keep only selected countries}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{ifelse}\NormalTok{(region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west, }\StringTok{"West"}\NormalTok{, }\StringTok{"Developing"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_histogram}\NormalTok{(}\DataTypeTok{binwidth =} \DecValTok{1}\NormalTok{, }\DataTypeTok{color =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(year }\OperatorTok{~}\StringTok{ }\NormalTok{group)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-119-1.pdf}

\emph{Code: Boxplots of income in West versus developing world, 1970 and
2010}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(past_year, present_year) }\OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\NormalTok{country_list) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{region =} \KeywordTok{reorder}\NormalTok{(region, dollars_per_day, }\DataTypeTok{FUN =}\NormalTok{ median)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{xlab}\NormalTok{(}\StringTok{""}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{)}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(region, dollars_per_day, }\DataTypeTok{fill =}\NormalTok{ continent)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(year }\OperatorTok{~}\StringTok{ }\NormalTok{.)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-120-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# arrange matching boxplots next to each other, colored by year}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_boxplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(region, dollars_per_day, }\DataTypeTok{fill =} \KeywordTok{factor}\NormalTok{(year)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-120-2.pdf}

\hypertarget{density-plots}{%
\subsection{Density Plots}\label{density-plots}}

The textbook for this section is available:

\begin{itemize}
\tightlist
\item
  \href{https://rafalab.github.io/dsbook/gapminder.html\#example-1970-versus-2010-income-distributions}{1970
  versus 2010 income distributions}
\item
  \href{https://rafalab.github.io/dsbook/gapminder.html\#accessing-computed-variables}{Accessing
  computed variables}
\item
  \href{https://rafalab.github.io/dsbook/gapminder.html\#weighted-densities}{Weighted
  densities}
\end{itemize}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  Change the y-axis of density plots to variable counts using
  \texttt{..count..} as the y argument.
\item
  The \texttt{case\_when} function defines a factor whose levels are
  defined by a variety of logical operations to group data.
\item
  Plot stacked density plots using \texttt{position="stack"}.
\item
  Define a weight \texttt{aesthetic} mapping to change the relative
  weights of density plots - for example, this allows weighting of plots
  by population rather than number of countries.
\end{itemize}

\emph{Code: Faceted smooth density plots}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# smooth density plots - area under each curve adds to 1}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\NormalTok{country_list) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{ifelse}\NormalTok{(region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west, }\StringTok{"West"}\NormalTok{, }\StringTok{"Developing"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{group_by}\NormalTok{(group) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{n =} \KeywordTok{n}\NormalTok{()) }\OperatorTok{%>%}\StringTok{ }\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{longtable}[]{@{}lr@{}}
\toprule
group & n\tabularnewline
\midrule
\endhead
Developing & 87\tabularnewline
West & 21\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# smooth density plots - variable counts on y-axis}
\NormalTok{p <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{==}\StringTok{ }\NormalTok{past_year }\OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\NormalTok{country_list) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{ifelse}\NormalTok{(region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west, }\StringTok{"West"}\NormalTok{, }\StringTok{"Developing"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day, }\DataTypeTok{y =}\NormalTok{ ..count.., }\DataTypeTok{fill =}\NormalTok{ group)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{)}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\DataTypeTok{bw =} \FloatTok{0.75}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_grid}\NormalTok{(year }\OperatorTok{~}\StringTok{ }\NormalTok{.)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-121-1.pdf}

\emph{Code: Add new region groups with case\_when}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add group as a factor, grouping regions}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{case_when}\NormalTok{(}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west }\OperatorTok{~}\StringTok{ "West"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Eastern Asia"}\NormalTok{, }\StringTok{"South-Eastern Asia"}\NormalTok{) }\OperatorTok{~}\StringTok{ "East Asia"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Caribbean"}\NormalTok{, }\StringTok{"Central America"}\NormalTok{, }\StringTok{"South America"}\NormalTok{) }\OperatorTok{~}\StringTok{ "Latin America"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{continent }\OperatorTok{==}\StringTok{ "Africa"} \OperatorTok{&}\StringTok{ }\NormalTok{.}\OperatorTok{$}\NormalTok{region }\OperatorTok{!=}\StringTok{ "Northern Africa"} \OperatorTok{~}\StringTok{ "Sub-Saharan Africa"}\NormalTok{,}
        \OtherTok{TRUE} \OperatorTok{~}\StringTok{ "Others"}\NormalTok{))}

\CommentTok{# reorder factor levels}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{factor}\NormalTok{(group, }\DataTypeTok{levels =} \KeywordTok{c}\NormalTok{(}\StringTok{"Others"}\NormalTok{, }\StringTok{"Latin America"}\NormalTok{, }\StringTok{"East Asia"}\NormalTok{, }\StringTok{"Sub-Saharan Africa"}\NormalTok{, }\StringTok{"West"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\emph{Code: Stacked density plot}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# note you must redefine p with the new gapminder object first}
\NormalTok{p <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(past_year, present_year) }\OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\NormalTok{country_list) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day, }\DataTypeTok{fill =}\NormalTok{ group)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{)}

\CommentTok{# stacked density plot}
\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\DataTypeTok{bw =} \FloatTok{0.75}\NormalTok{, }\DataTypeTok{position =} \StringTok{"stack"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(year }\OperatorTok{~}\StringTok{ }\NormalTok{.)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-123-1.pdf}

\emph{Code: Weighted stacked density plot}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# weighted stacked density plot}
\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(past_year, present_year) }\OperatorTok{&}\StringTok{ }\NormalTok{country }\OperatorTok{%in%}\StringTok{ }\NormalTok{country_list) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(year) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{weight =}\NormalTok{ population}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(population}\OperatorTok{*}\DecValTok{2}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ungroup}\NormalTok{() }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(dollars_per_day, }\DataTypeTok{fill =}\NormalTok{ group, }\DataTypeTok{weight =}\NormalTok{ weight)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_density}\NormalTok{(}\DataTypeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\DataTypeTok{bw =} \FloatTok{0.75}\NormalTok{, }\DataTypeTok{position =} \StringTok{"stack"}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{facet_grid}\NormalTok{(year }\OperatorTok{~}\StringTok{ }\NormalTok{.)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-124-1.pdf}

\hypertarget{ecological-fallacy}{%
\subsection{Ecological Fallacy}\label{ecological-fallacy}}

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/gapminder.html\#the-ecological-fallacy-and-importance-of-showing-the-data}{here}

\textbf{Key points}

\begin{itemize}
\tightlist
\item
  The \emph{breaks} argument allows us to set the location of the axis
  labels and tick marks.
\item
  The \emph{logistic} or \emph{logit transformation} is defined as
  \(f(p) = log \frac{p}{1-p}\), or the log of odds. This scale is useful
  for highlighting differences near 0 or near 1 and converts fold
  changes into constant increases.
\item
  The \emph{ecological fallacy} is assuming that conclusions made from
  the average of a group apply to all members of that group.
\end{itemize}

\emph{Code}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add additional cases}
\NormalTok{gapminder <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{group =} \KeywordTok{case_when}\NormalTok{(}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\NormalTok{west }\OperatorTok{~}\StringTok{ "The West"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ "Northern Africa"} \OperatorTok{~}\StringTok{ "Northern Africa"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Eastern Asia"}\NormalTok{, }\StringTok{"South-Eastern Asia"}\NormalTok{) }\OperatorTok{~}\StringTok{ "East Asia"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{==}\StringTok{ "Southern Asia"} \OperatorTok{~}\StringTok{ "Southern Asia"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Central America"}\NormalTok{, }\StringTok{"South America"}\NormalTok{, }\StringTok{"Caribbean"}\NormalTok{) }\OperatorTok{~}\StringTok{ "Latin America"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{continent }\OperatorTok{==}\StringTok{ "Africa"} \OperatorTok{&}\StringTok{ }\NormalTok{.}\OperatorTok{$}\NormalTok{region }\OperatorTok{!=}\StringTok{ "Northern Africa"} \OperatorTok{~}\StringTok{ "Sub-Saharan Africa"}\NormalTok{,}
\NormalTok{        .}\OperatorTok{$}\NormalTok{region }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Melanesia"}\NormalTok{, }\StringTok{"Micronesia"}\NormalTok{, }\StringTok{"Polynesia"}\NormalTok{) }\OperatorTok{~}\StringTok{ "Pacific Islands"}\NormalTok{))}

\CommentTok{# define a data frame with group average income and average infant survival rate}
\NormalTok{surv_income <-}\StringTok{ }\NormalTok{gapminder }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\NormalTok{present_year }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(gdp) }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(infant_mortality) }\OperatorTok{&}\StringTok{ }\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(group)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{group_by}\NormalTok{(group) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{summarize}\NormalTok{(}\DataTypeTok{income =} \KeywordTok{sum}\NormalTok{(gdp)}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(population)}\OperatorTok{/}\DecValTok{365}\NormalTok{,}
                        \DataTypeTok{infant_survival_rate =} \DecValTok{1} \OperatorTok{-}\StringTok{ }\KeywordTok{sum}\NormalTok{(infant_mortality}\OperatorTok{/}\DecValTok{1000}\OperatorTok{*}\NormalTok{population)}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(population))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` ungrouping output (override with `.groups` argument)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{surv_income }\OperatorTok{%>%}\StringTok{ }\KeywordTok{arrange}\NormalTok{(income)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 3
##   group              income infant_survival_rate
##   <chr>               <dbl>                <dbl>
## 1 Sub-Saharan Africa   1.76                0.936
## 2 Southern Asia        2.07                0.952
## 3 Pacific Islands      2.70                0.956
## 4 Northern Africa      4.94                0.970
## 5 Latin America       13.2                 0.983
## 6 East Asia           13.4                 0.985
## 7 The West            77.1                 0.995
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# plot infant survival versus income, with transformed axes}
\NormalTok{surv_income }\OperatorTok{%>%}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(income, infant_survival_rate, }\DataTypeTok{label =}\NormalTok{ group, }\DataTypeTok{color =}\NormalTok{ group)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_x_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"log2"}\NormalTok{, }\DataTypeTok{limit =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\DecValTok{150}\NormalTok{)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{scale_y_continuous}\NormalTok{(}\DataTypeTok{trans =} \StringTok{"logit"}\NormalTok{, }\DataTypeTok{limit =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.875}\NormalTok{, }\FloatTok{.9981}\NormalTok{),}
                                       \DataTypeTok{breaks =} \KeywordTok{c}\NormalTok{(.}\DecValTok{85}\NormalTok{, }\FloatTok{.90}\NormalTok{, }\FloatTok{.95}\NormalTok{, }\FloatTok{.99}\NormalTok{, }\FloatTok{.995}\NormalTok{, }\FloatTok{.998}\NormalTok{)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_label}\NormalTok{(}\DataTypeTok{size =} \DecValTok{3}\NormalTok{, }\DataTypeTok{show.legend =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-125-1.pdf}

\hypertarget{assessment-8-exploring-the-gapminder-dataset}{%
\subsection{Assessment 8 (Exploring the Gapminder
Dataset)}\label{assessment-8-exploring-the-gapminder-dataset}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Life expectancy vs fertility - part 1
\end{enumerate}

The \href{https://www.gapminder.org/}{Gapminder Foundation} is a
non-profit organization based in Sweden that promotes global development
through the use of statistics that can help reduce misconceptions about
global development.

\begin{itemize}
\tightlist
\item
  Using ggplot and the points layer, create a scatter plot of life
  expectancy versus fertility for the African continent in 2012.
\item
  Remember that you can use the R console to explore the gapminder
  dataset to figure out the names of the columns in the dataframe.
\item
  In this exercise we provide parts of code to get you going. You need
  to fill out what is missing. But note that going forward, in the next
  exercises, you will be required to write most of the code.
\end{itemize}

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)
head(gapminder)
\end{verbatim}

\begin{verbatim}
   country             year       infant_mortality      life_expectancy     fertility     population
   <fctr>              <int>      <dbl>                 <dbl>               <dbl>         <dbl>
1  Albania         1960   115.40            62.87               6.19      1636054   
2  Algeria         1960   148.20            47.50               7.65      11124892  
3  Angola          1960   208.00            35.98               7.32      5270844   
4  Antigua and Barbuda 1960   NA                    62.97               4.43      54681 
5  Argentina           1960   59.87                 65.39               3.11      20619075  
6  Armenia         1960   NA                    66.86               4.55      1867396   
6 rows | 1-7 of 10 columns
\end{verbatim}

\begin{verbatim}
## fill out the missing parts in filter and aes
gapminder %>% filter(continent=="Africa" & year=="2012") %>%
  ggplot(aes(fertility,life_expectancy)) +
  geom_point()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76077478-1252a180-5fa1-11ea-8a6f-ab77face26e4.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Life expectancy vs fertility - part 2 - coloring your plot
\end{enumerate}

Note that there is quite a bit of variability in life expectancy and
fertility with some African countries having very high life
expectancies. There also appear to be three clusters in the plot.

Remake the plot from the previous exercises but this time use color to
dinstinguish the different regions of Africa to see if this explains the
clusters. Remember that you can explore the gapminder data to see how
the regions of Africa are labeled in the dataframe!

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)

gapminder %>% filter(continent=="Africa" & year=="2012") %>%
  ggplot(aes(fertility,life_expectancy, color=region)) +
  geom_point()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76077664-6e1d2a80-5fa1-11ea-8fb1-256ad41ec093.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Life expectancy vs fertility - part 3 - selecting country and region
\end{enumerate}

While many of the countries in the high life expectancy/low fertility
cluster are from Northern Africa, three countries are not.

\begin{itemize}
\tightlist
\item
  Create a table showing the country and region for the African
  countries (use select) that in 2012 had fertility rates of 3 or less
  and life expectancies of at least 70.
\item
  Assign your result to a data frame called df.
\end{itemize}

\begin{verbatim}
library(dplyr)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)
head(gapminder)
\end{verbatim}

\begin{verbatim}
   country             year       infant_mortality      life_expectancy     fertility     population
   <fctr>              <int>      <dbl>                 <dbl>               <dbl>         <dbl>
1  Albania         1960   115.40            62.87               6.19      1636054   
2  Algeria         1960   148.20            47.50               7.65      11124892  
3  Angola          1960   208.00            35.98               7.32      5270844   
4  Antigua and Barbuda 1960   NA                    62.97               4.43      54681 
5  Argentina           1960   59.87                 65.39               3.11      20619075  
6  Armenia         1960   NA                    66.86               4.55      1867396   
6 rows | 1-7 of 10 columns
\end{verbatim}

\begin{verbatim}
df <- gapminder %>% filter(continent=="Africa" & year=="2012" & fertility <=3 & life_expectancy>=70) %>%
  select(country,region)
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Life expectancy and the Vietnam War - part 1
\end{enumerate}

The Vietnam War lasted from 1955 to 1975. Do the data support war having
a negative effect on life expectancy? We will create a time series plot
that covers the period from 1960 to 2010 of life expectancy for Vietnam
and the United States, using color to distinguish the two countries. In
this start we start the analysis by generating a table.

\begin{itemize}
\tightlist
\item
  Use filter to create a table with data for the years from 1960 to 2010
  in Vietnam and the United States.
\item
  Save the table in an object called tab.
\end{itemize}

\begin{verbatim}
library(dplyr)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)

head(gapminder)
\end{verbatim}

\begin{verbatim}
   country             year       infant_mortality      life_expectancy     fertility     population
   <fctr>              <int>      <dbl>                 <dbl>               <dbl>         <dbl>
1  Albania         1960   115.40            62.87               6.19      1636054   
2  Algeria         1960   148.20            47.50               7.65      11124892  
3  Angola          1960   208.00            35.98               7.32      5270844   
4  Antigua and Barbuda 1960   NA                    62.97               4.43      54681 
5  Argentina           1960   59.87                 65.39               3.11      20619075  
6  Armenia         1960   NA                    66.86               4.55      1867396   
6 rows | 1-7 of 10 columns
\end{verbatim}

\begin{verbatim}
tab <- gapminder %>% filter(year>=1960 & year<=2010 & country%in%c("Vietnam","United States"))
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Life expectancy and the Vietnam War - part 2
\end{enumerate}

Now that you have created the data table in Exercise 4, it is time to
plot the data for the two countries.

\begin{itemize}
\tightlist
\item
  Use geom\_line to plot life expectancy vs year for Vietnam and the
  United States. The data table is stored in tab.
\item
  Use color to distinguish the two countries.
\end{itemize}

\begin{verbatim}
p <- tab %>% ggplot(aes(year,life_expectancy,color=country)) + geom_line()
p
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76078449-ffd96780-5fa2-11ea-8f57-93389b4435bf.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Life expectancy in Cambodia
\end{enumerate}

Cambodia was also involved in this conflict and, after the war, Pol Pot
and his communist Khmer Rouge took control and ruled Cambodia from 1975
to 1979. He is considered one of the most brutal dictators in history.
Do the data support this claim?

Use a single line of code to create a time series plot from 1960 to 2010
of life expectancy vs year for Cambodia.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)

gapminder %>% filter(year>=1960 & year <= 2010 & country=="Cambodia") %>% ggplot(aes(year,life_expectancy)) + geom_line()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76078812-b50c1f80-5fa3-11ea-8301-e3f67e12470b.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  Dollars per day - part 1
\end{enumerate}

Now we are going to calculate and plot dollars per day for African
countries in 2010 using GDP data.

In the first part of this analysis, we will create the dollars per day
variable. - Use mutate to create a dollars\_per\_day variable, which is
defined as gdp/population/365. - Create the dollars\_per\_day variable
for African countries for the year 2010. - Remove any NA values. - Save
the mutated dataset as daydollars.

\begin{verbatim}
library(dplyr)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)
daydollars <- gapminder %>% mutate(dollars_per_day=gdp/population/365)%>% filter(year==2010 & continent=="Africa" & !is.na(dollars_per_day))
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Dollars per day - part 2
\end{enumerate}

Now we are going to calculate and plot dollars per day for African
countries in 2010 using GDP data.

In the second part of this analysis, we will plot the smooth density
plot using a log (base 2) x axis. - The dataset including the
dollars\_per\_day variable is preloaded as daydollars. - Create a smooth
density plot of dollars per day from daydollars. - Use a log (base 2)
scale for the x axis.

\begin{verbatim}
daydollars %>% ggplot(aes(dollars_per_day)) + geom_density() + scale_x_continuous(trans="log2")
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079001-16cc8980-5fa4-11ea-87da-614f4318ae88.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  Dollars per day - part 3 - multiple density plots
\end{enumerate}

Now we are going to combine the plotting tools we have used in the past
two exercises to create density plots for multiple years. - Create the
dollars\_per\_day variable as in Exercise 7, but for African countries
in the years 1970 and 2010 this time. - Make sure you remove any NA
values. - Create a smooth density plot of dollars per day for 1970 and
2010 using a log (base 2) scale for the x axis. - Use facet\_grid to
show a different density plot for 1970 and 2010.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)

daydollars <- gapminder %>% mutate(dollars_per_day=gdp/population/365)%>% filter(year %in% c(1970,2010) & continent=="Africa" & !is.na(dollars_per_day))

daydollars %>% ggplot(aes(dollars_per_day)) + geom_density() + scale_x_continuous(trans='log2') + facet_grid(.~year)
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079192-74f96c80-5fa4-11ea-8fcf-1ccb1aa19636.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  Dollars per day - part 4 - stacked histograms
\end{enumerate}

Now we are going to edit the code from Exercise 9 to show stacked
histograms of each region in Africa.

Much of the code will be the same as in Exercise 9: - Create the
dollars\_per\_day variable as in Exercise 7, but for African countries
in the years 1970 and 2010 this time. - Make sure you remove any NA
values. - Create a smooth density plot of dollars per day for 1970 and
2010 using a log (base 2) scale for the x axis. - Use facet\_grid to
show a different density plot for 1970 and 2010. - Make sure the
densities are smooth by using bw = 0.5. - Use the fill and position
arguments where appropriate to create the stacked histograms of each
region.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)

daydollars <- gapminder %>% mutate(dollars_per_day=gdp/population/365)%>% filter(year %in% c(1970,2010) & continent=="Africa" & !is.na(dollars_per_day))

daydollars %>% ggplot(aes(dollars_per_day,fill = region)) + geom_density(bw=0.5,position='stack') + scale_x_continuous(trans='log2') + facet_grid(.~year)
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079366-c86bba80-5fa4-11ea-8a1e-00ac6915239a.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{10}
\tightlist
\item
  Infant mortality scatter plot - part 1
\end{enumerate}

We are going to continue looking at patterns in the gapminder dataset by
plotting infant mortality rates versus dollars per day for African
countries. - Generate dollars\_per\_day using mutate and filter for the
year 2010 for African countries. - Remember to remove NA values. - Store
the mutated dataset in gapminder\_Africa\_2010. - Make a scatter plot of
infant\_mortaility versus dollars\_per\_day for countries in the African
continent. - Use color to denote the different regions of Africa.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)
gapminder_Africa_2010 <- daydollars <- gapminder %>% mutate(dollars_per_day=gdp/population/365)%>% filter(year %in% c(2010) & continent=="Africa" & !is.na(dollars_per_day))

# now make the scatter plot

gapminder_Africa_2010 %>% ggplot(aes(dollars_per_day,infant_mortality,color = region)) + geom_point()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079538-226c8000-5fa5-11ea-8a89-fb738049dfcf.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{11}
\tightlist
\item
  Infant mortality scatter plot - part 2 - logarithmic axis
\end{enumerate}

Now we are going to transform the x axis of the plot from the previous
exercise. - The mutated dataset is preloaded as gapminder\_Africa\_2010.
- As in the previous exercise, make a scatter plot of infant\_mortaility
versus dollars\_per\_day for countries in the African continent. - As in
the previous exercise, use color to denote the different regions of
Africa. - Transform the x axis to be in the log (base 2) scale.

\begin{verbatim}
gapminder_Africa_2010 %>% ggplot(aes(dollars_per_day,infant_mortality, color=region)) + geom_point() + scale_x_continuous(trans='log2')
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079652-619ad100-5fa5-11ea-87ab-893c889572df.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{12}
\tightlist
\item
  Infant mortality scatter plot - part 3 - adding labels
\end{enumerate}

Note that there is a large variation in infant mortality and dollars per
day among African countries.

As an example, one country has infant mortality rates of less than 20
per 1000 and dollars per day of 16, while another country has infant
mortality rates over 10\% and dollars per day of about 1.

In this exercise, we will remake the plot from Exercise 12 with country
names instead of points so we can identify which countries are which. -
The mutated dataset is preloaded as gapminder\_Africa\_2010. - As in the
previous exercise, make a scatter plot of infant\_mortaility versus
dollars\_per\_day for countries in the African continent. - As in the
previous exercise, use color to denote the different regions of Africa.
- As in the previous exercise, transform the x axis to be in the log
(base 2) scale. - Add a layer to display country names instead of
points.

\begin{verbatim}
gapminder_Africa_2010 %>% ggplot(aes(dollars_per_day,infant_mortality, color=region,label = country)) + geom_point() + scale_x_continuous(trans='log2') +
    geom_text()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079763-acb4e400-5fa5-11ea-9c68-a36471bafd20.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{13}
\tightlist
\item
  Infant mortality scatter plot - part 4 - comparison of scatter plots
\end{enumerate}

Now we are going to look at changes in the infant mortality and dollars
per day patterns African countries between 1970 and 2010. - Generate
dollars\_per\_day using mutate and filter for the years 1970 and 2010
for African countries. - Remember to remove NA values. - As in the
previous exercise, make a scatter plot of infant\_mortaility versus
dollars\_per\_day for countries in the African continent. - As in the
previous exercise, use color to denote the different regions of Africa.
- As in the previous exercise, transform the x axis to be in the log
(base 2) scale. - As in the previous exercise, add a layer to display
country names instead of points. - Use facet\_grid to show different
plots for 1970 and 2010.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(gapminder)
gapminder  %>%
    filter(continent == "Africa" & year %in% c(1970,2010) & !is.na(gdp) & !is.na(year) & !is.na(infant_mortality)) %>%
    mutate(dollars_per_day = gdp/population/365) %>%
    ggplot(aes(dollars_per_day, infant_mortality, color = region,label = country)) +
    geom_point() +
    scale_x_continuous(trans = "log2") +
    geom_text() +
    facet_grid(year~.)
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76079914-09b09a00-5fa6-11ea-8f39-f8556253ee2c.png}
\caption{index}
\end{figure}

\hypertarget{section-5-overview}{%
\subsection{Section 5 Overview}\label{section-5-overview}}

Section 5 covers some general principles that can serve as guides for
effective data visualization.

After completing Section 5, you will: - understand basic principles of
effective data visualization. - understand the importance of keeping
your goal in mind when deciding on a visualization approach. -
understand principles for encoding data, including position, aligned
lengths, angles, area, brightness, and color hue. - know when to include
the number zero in visualizations. - be able to use techniques to ease
comparisons, such as using common axes, putting visual cues to be
compared adjacent to one another, and using color effectively.

The textbook for this section is available
\href{https://rafalab.github.io/dsbook/data-visualization-principles.html}{here}

\hypertarget{assessment-9-data-visualization-principles-part-1}{%
\subsection{Assessment 9 (Data Visualization Principles, Part
1)}\label{assessment-9-data-visualization-principles-part-1}}

1: Customizing plots - Pie charts

Pie charts are appropriate: - {[} {]} A. When we want to display
percentages. - {[} {]} B. When ggplot2 is not available. - {[} {]} C.
When I am in a bakery. - {[}X{]} D. Never. Barplots and tables are
always better.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Customizing plots - What's wrong?
\end{enumerate}

What is the problem with this plot?

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76088773-e6431a80-5fb8-11ea-9346-3e065a4b05df.png}
\caption{index}
\end{figure}

\begin{itemize}
\tightlist
\item[$\square$]
  A. The values are wrong. The final vote was 306 to 232.
\item[$\boxtimes$]
  B. The axis does not start at 0. Judging by the length, it appears
  Trump received 3 times as many votes when in fact it was about 30\%
  more.
\item[$\square$]
  C. The colors should be the same.
\item[$\square$]
  D. Percentages should be shown as a pie chart.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Customizing plots - What's wrong 2?.
\end{enumerate}

Take a look at the following two plots. They show the same information:
rates of measles by state in the United States for 1928.

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76088976-37530e80-5fb9-11ea-9642-a94d5f40d7ae.png}
\caption{index}
\end{figure}

\begin{itemize}
\tightlist
\item[$\square$]
  A. Both plots provide the same information, so they are equally good.
\item[$\square$]
  B. The plot on the left is better because it orders the states
  alphabetically.
\item[$\boxtimes$]
  C. The plot on the right is better because it orders the states by
  disease rate so we can quickly see the states with highest and lowest
  rates.
\item[$\square$]
  D. Both plots should be pie charts instead.
\end{itemize}

\hypertarget{assessment-10-data-visualization-principles-part-2}{%
\subsection{Assessment 10 (Data Visualization Principles, Part
2)}\label{assessment-10-data-visualization-principles-part-2}}

1: Customizing plots - watch and learn

To make the plot on the right in the exercise from the last set of
assessments, we had to reorder the levels of the states' variables. -
Redefine the state object so that the levels are re-ordered by rate. -
Print the new object state and its levels so you can see that the vector
is now re-ordered by the levels.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
dat <- us_contagious_diseases %>%
filter(year == 1967 & disease=="Measles" & !is.na(population)) %>% mutate(rate = count / population * 10000 * 52 / weeks_reporting)
state <- dat$state 
rate <- dat$count/(dat$population/10000)*(52/dat$weeks_reporting)

state <- reorder(state,rate)
print(state)
\end{verbatim}

\begin{verbatim}
##  [1] Alabama              Alaska               Arizona             
##  [4] Arkansas             California           Colorado            
##  [7] Connecticut          Delaware             District Of Columbia
## [10] Florida              Georgia              Hawaii              
## [13] Idaho                Illinois             Indiana             
## [16] Iowa                 Kansas               Kentucky            
## [19] Louisiana            Maine                Maryland            
## [22] Massachusetts        Michigan             Minnesota           
## [25] Mississippi          Missouri             Montana             
## [28] Nebraska             Nevada               New Hampshire       
## [31] New Jersey           New Mexico           New York            
## [34] North Carolina       North Dakota         Ohio                
## [37] Oklahoma             Oregon               Pennsylvania        
## [40] Rhode Island         South Carolina       South Dakota        
## [43] Tennessee            Texas                Utah                
## [46] Vermont              Virginia             Washington          
## [49] West Virginia        Wisconsin            Wyoming             
## attr(,"scores")
##              Alabama               Alaska              Arizona 
##           4.16107582           5.46389893           6.32695891 
##             Arkansas           California             Colorado 
##           6.87899954           2.79313560           7.96331905 
##          Connecticut             Delaware District Of Columbia 
##           0.36986840           1.13098183           0.35873614 
##              Florida              Georgia               Hawaii 
##           2.89358806           0.09987991           2.50173748 
##                Idaho             Illinois              Indiana 
##           6.03115170           1.20115480           1.34027323 
##                 Iowa               Kansas             Kentucky 
##           2.94948911           0.66386422           4.74576011 
##            Louisiana                Maine             Maryland 
##           0.46088071           2.57520433           0.49922233 
##        Massachusetts             Michigan            Minnesota 
##           0.74762338           1.33466700           0.37722410 
##          Mississippi             Missouri              Montana 
##           3.11366532           0.75696354           5.00433320 
##             Nebraska               Nevada        New Hampshire 
##           3.64389801           6.43683882           0.47181511 
##           New Jersey           New Mexico             New York 
##           0.88414264           6.15969926           0.66849058 
##       North Carolina         North Dakota                 Ohio 
##           1.92529764          14.48024642           1.16382241 
##             Oklahoma               Oregon         Pennsylvania 
##           3.27496900           8.75036439           0.67687303 
##         Rhode Island       South Carolina         South Dakota 
##           0.68207448           2.10412531           0.90289534 
##            Tennessee                Texas                 Utah 
##           5.47344506          12.49773953           4.03005836 
##              Vermont             Virginia           Washington 
##           1.00970314           5.28270939          17.65180349 
##        West Virginia            Wisconsin              Wyoming 
##           8.59456463           4.96246019           6.97303449 
## 51 Levels: Georgia District Of Columbia Connecticut ... Washington
\end{verbatim}

\begin{verbatim}
levels(state)
\end{verbatim}

\begin{verbatim}
##  [1] "Georgia"              "District Of Columbia" "Connecticut"         
##  [4] "Minnesota"            "Louisiana"            "New Hampshire"       
##  [7] "Maryland"             "Kansas"               "New York"            
## [10] "Pennsylvania"         "Rhode Island"         "Massachusetts"       
## [13] "Missouri"             "New Jersey"           "South Dakota"        
## [16] "Vermont"              "Delaware"             "Ohio"                
## [19] "Illinois"             "Michigan"             "Indiana"             
## [22] "North Carolina"       "South Carolina"       "Hawaii"              
## [25] "Maine"                "California"           "Florida"             
## [28] "Iowa"                 "Mississippi"          "Oklahoma"            
## [31] "Nebraska"             "Utah"                 "Alabama"             
## [34] "Kentucky"             "Wisconsin"            "Montana"             
## [37] "Virginia"             "Alaska"               "Tennessee"           
## [40] "Idaho"                "New Mexico"           "Arizona"             
## [43] "Nevada"               "Arkansas"             "Wyoming"             
## [46] "Colorado"             "West Virginia"        "Oregon"              
## [49] "Texas"                "North Dakota"         "Washington"
\end{verbatim}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Customizing plots - redefining
\end{enumerate}

Now we are going to customize this plot a little more by creating a rate
variable and reordering by that variable instead. - Add a single line of
code to the definition of the dat table that uses mutate to reorder the
states by the rate variable. - The sample code provided will then create
a bar plot using the newly defined dat.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)
dat <- us_contagious_diseases %>% filter(year == 1967 & disease=="Measles" & count>0 & !is.na(population)) %>%
  mutate(rate = count / population * 10000 * 52 / weeks_reporting) %>% mutate(state = reorder(state, rate))
dat %>% ggplot(aes(state, rate)) +
  geom_bar(stat="identity") +
  coord_flip()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76089443-f4456b00-5fb9-11ea-965f-31e0e94ee988.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Showing the data and customizing plots
\end{enumerate}

Say we are interested in comparing gun homicide rates across regions of
the US. We see this plot:

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data("murders")
murders %>% mutate(rate = total/population*100000) %>%
  group_by(region) %>%
  summarize(avg = mean(rate)) %>%
  mutate(region = factor(region)) %>%
  ggplot(aes(region, avg)) +
  geom_bar(stat="identity") +
  ylab("Murder Rate Average")
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76089561-2e167180-5fba-11ea-901f-7335621734ff.png}
\caption{index}
\end{figure}

and decide to move to a state in the western region. What is the main
problem with this interpretaion? - {[} {]} A. The categories are ordered
alphabetically. - {[} {]} B. The graph does not show standard errors. -
{[}X{]} C. It does not show all the data. We do not see the variability
within a region and it's possible that the safest states are not in the
West. - {[} {]} D. The Northeast has the lowest average.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Making a box plot
\end{enumerate}

To further investigate whether moving to the western region is a wise
decision, let's make a box plot of murder rates by region, showing all
points. - Make a box plot of the murder rates by region. - Order the
regions by their median murder rate. - Show all of the points on the box
plot.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data("murders")
murders %>% mutate(rate = total/population*100000) %>%
  mutate(region=reorder(region, rate, FUN=median)) %>%
  ggplot(aes(region, rate)) +
  geom_boxplot() +
  geom_point()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76089763-97968000-5fba-11ea-914e-0d5817ff7665.png}
\caption{index}
\end{figure}

\hypertarget{assessment-11-data-visualization-principles-part-3}{%
\subsection{Assessment 11 (Data Visualization Principles, Part
3)}\label{assessment-11-data-visualization-principles-part-3}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Tile plot - measles and smallpox
\end{enumerate}

The sample code given creates a tile plot showing the rate of measles
cases per population. We are going to modify the tile plot to look at
smallpox cases instead.

\begin{verbatim}
if(!require(RColorBrewer)) install.packages("RColorBrewer")

library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)
head(us_contagious_diseases)
\end{verbatim}

\begin{verbatim}
   disease       state      year      weeks_reporting     count      population
   <fctr>        <fctr>     <dbl>     <int>               <dbl>      <dbl>
1  Hepatitis A   Alabama    1966      50              321        3345787
2  Hepatitis A   Alabama    1967      49              291        3364130
3  Hepatitis A   Alabama    1968      52              314        3386068
4  Hepatitis A   Alabama    1969      49              380        3412450
5  Hepatitis A   Alabama    1970      51                  413        3444165
6  Hepatitis A   Alabama    1971      51              378        3481798
6 rows
\end{verbatim}

\begin{verbatim}
the_disease = "Measles"
dat <- us_contagious_diseases %>% 
   filter(!state%in%c("Hawaii","Alaska") & disease == the_disease) %>% 
   mutate(rate = count / population * 10000) %>% 
   mutate(state = reorder(state, rate))

dat %>% ggplot(aes(year, state, fill = rate)) + 
  geom_tile(color = "grey50") + 
  scale_x_continuous(expand=c(0,0)) + 
  scale_fill_gradientn(colors = brewer.pal(9, "Reds"), trans = "sqrt") + 
  theme_minimal() + 
  theme(panel.grid = element_blank()) + 
  ggtitle(the_disease) + 
  ylab("") + 
  xlab("")
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76090644-396a9c80-5fbc-11ea-82c3-f440dd00decd.png}
\caption{index}
\end{figure}

\begin{itemize}
\tightlist
\item
  Modify the tile plot to show the rate of smallpox cases instead of
  measles cases.
\item
  Exclude years in which cases were reported in fewer than 10 weeks from
  the plot.
\end{itemize}

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(dslabs)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)
head(us_contagious_diseases)
\end{verbatim}

\begin{verbatim}
   disease       state      year      weeks_reporting     count      population
   <fctr>        <fctr>     <dbl>     <int>               <dbl>      <dbl>
1  Hepatitis A   Alabama    1966      50              321        3345787
2  Hepatitis A   Alabama    1967      49              291        3364130
3  Hepatitis A   Alabama    1968      52              314        3386068
4  Hepatitis A   Alabama    1969      49              380        3412450
5  Hepatitis A   Alabama    1970      51              413        3444165
6  Hepatitis A   Alabama    1971      51              378        3481798
6 rows
\end{verbatim}

\begin{verbatim}
the_disease = "Smallpox"
dat <- us_contagious_diseases %>% 
   filter(!state%in%c("Hawaii","Alaska") & disease == the_disease & !weeks_reporting<10) %>% 
   mutate(rate = count / population * 10000) %>% 
   mutate(state = reorder(state, rate))

dat %>% ggplot(aes(year, state, fill = rate)) + 
  geom_tile(color = "grey50") + 
  scale_x_continuous(expand=c(0,0)) + 
  scale_fill_gradientn(colors = brewer.pal(9, "Reds"), trans = "sqrt") + 
  theme_minimal() + 
  theme(panel.grid = element_blank()) + 
  ggtitle(the_disease) + 
  ylab("") + 
  xlab("")
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76090911-c9104b00-5fbc-11ea-8fac-fb1a2b2a68f5.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Time series plot - measles and smallpox
\end{enumerate}

The sample code given creates a time series plot showing the rate of
measles cases per population by state. We are going to again modify this
plot to look at smallpox cases instead.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
library(RColorBrewer)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)

the_disease = "Measles"
dat <- us_contagious_diseases %>%
   filter(!state%in%c("Hawaii","Alaska") & disease == the_disease) %>%
   mutate(rate = count / population * 10000) %>%
   mutate(state = reorder(state, rate))
str(dat)
\end{verbatim}

\begin{verbatim}
## 'data.frame':    3724 obs. of  7 variables:
##  $ disease        : Factor w/ 7 levels "Hepatitis A",..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ state          : Factor w/ 51 levels "Mississippi",..: 9 9 9 9 9 9 9 9 9 9 ...
##   ..- attr(*, "scores")= num [1:51(1d)] 9.27 NA 24.15 9.37 19.16 ...
##   .. ..- attr(*, "dimnames")=List of 1
##   .. .. ..$ : chr  "Alabama" "Alaska" "Arizona" "Arkansas" ...
##  $ year           : num  1928 1929 1930 1931 1932 ...
##  $ weeks_reporting: int  52 49 52 49 41 51 52 49 40 49 ...
##  $ count          : num  8843 2959 4156 8934 270 ...
##  $ population     : num  2589923 2619131 2646248 2670818 2693027 ...
##  $ rate           : num  34.1 11.3 15.7 33.5 1 ...
\end{verbatim}

\begin{verbatim}
avg <- us_contagious_diseases %>%
  filter(disease==the_disease) %>% group_by(year) %>%
  summarize(us_rate = sum(count, na.rm=TRUE)/sum(population, na.rm=TRUE)*10000)

dat %>% ggplot() +
  geom_line(aes(year, rate, group = state),  color = "grey50", 
            show.legend = FALSE, alpha = 0.2, size = 1) +
  geom_line(mapping = aes(year, us_rate),  data = avg, size = 1, color = "black") +
  scale_y_continuous(trans = "sqrt", breaks = c(5,25,125,300)) + 
  ggtitle("Cases per 10,000 by state") + 
  xlab("") + 
  ylab("") +
  geom_text(data = data.frame(x=1955, y=50), mapping = aes(x, y, label="US average"), color="black") + 
  geom_vline(xintercept=1963, col = "blue")
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76091054-21474d00-5fbd-11ea-9492-6f335200aba6.png}
\caption{index}
\end{figure}

\begin{itemize}
\tightlist
\item
  Modify the sample code for the time series plot to plot data for
  smallpox instead of for measles.
\item
  Once again, restrict the plot to years in which cases were reported in
  at least 10 weeks.
\end{itemize}

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
library(RColorBrewer)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)

the_disease = "Smallpox"
dat <- us_contagious_diseases %>%
   filter(!state%in%c("Hawaii","Alaska") & disease == the_disease & !weeks_reporting<10) %>%
   mutate(rate = count / population * 10000) %>%
   mutate(state = reorder(state, rate))
str(dat)
\end{verbatim}

\begin{verbatim}
## 'data.frame':    1014 obs. of  7 variables:
##  $ disease        : Factor w/ 7 levels "Hepatitis A",..: 7 7 7 7 7 7 7 7 7 7 ...
##  $ state          : Factor w/ 51 levels "Rhode Island",..: 17 17 17 17 17 17 17 17 17 17 ...
##   ..- attr(*, "scores")= num [1:51(1d)] 0.382 NA 2.011 0.805 0.924 ...
##   .. ..- attr(*, "dimnames")=List of 1
##   .. .. ..$ : chr  "Alabama" "Alaska" "Arizona" "Arkansas" ...
##  $ year           : num  1928 1929 1930 1931 1932 ...
##  $ weeks_reporting: int  51 52 52 52 52 52 52 52 51 52 ...
##  $ count          : num  341 378 192 295 467 82 23 42 12 54 ...
##  $ population     : num  2589923 2619131 2646248 2670818 2693027 ...
##  $ rate           : num  1.317 1.443 0.726 1.105 1.734 ...
\end{verbatim}

\begin{verbatim}
avg <- us_contagious_diseases %>%
  filter(disease==the_disease) %>% group_by(year) %>%
  summarize(us_rate = sum(count, na.rm=TRUE)/sum(population, na.rm=TRUE)*10000)

dat %>% ggplot() +
  geom_line(aes(year, rate, group = state),  color = "grey50", 
            show.legend = FALSE, alpha = 0.2, size = 1) +
  geom_line(mapping = aes(year, us_rate),  data = avg, size = 1, color = "black") +
  scale_y_continuous(trans = "sqrt", breaks = c(5,25,125,300)) + 
  ggtitle("Cases per 10,000 by state") + 
  xlab("") + 
  ylab("") +
  geom_text(data = data.frame(x=1955, y=50), mapping = aes(x, y, label="US average"), color="black") + 
  geom_vline(xintercept=1963, col = "blue")
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76091191-61a6cb00-5fbd-11ea-9d09-f8d10995d59c.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Time series plot - all diseases in California
\end{enumerate}

Now we are going to look at the rates of all diseases in one state.
Again, you will be modifying the sample code to produce the desired
plot. - For the state of California, make a time series plot showing
rates for all diseases. - Include only years with 10 or more weeks
reporting. - Use a different color for each disease.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
library(RColorBrewer)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)

us_contagious_diseases %>% filter(state=="California" & !weeks_reporting<10) %>% 
  group_by(year, disease) %>%
  summarize(rate = sum(count)/sum(population)*10000) %>%
  ggplot(aes(year, rate,color=disease)) + 
  geom_line()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76091336-ad597480-5fbd-11ea-945b-b908f19a681d.png}
\caption{index}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Time series plot - all diseases in the United States
\end{enumerate}

Now we are going to make a time series plot for the rates of all
diseases in the United States. For this exercise, we have provided less
sample code - you can take a look at the previous exercise to get you
started. - Compute the US rate by using summarize to sum over states. -
The US rate for each disease will be the total number of cases divided
by the total population. - Remember to convert to cases per 10,000. -
You will need to filter for !is.na(population) to get all the data. -
Plot each disease in a different color.

\begin{verbatim}
library(dplyr)
library(ggplot2)
library(dslabs)
library(RColorBrewer)
\end{verbatim}

\begin{verbatim}
data(us_contagious_diseases)

us_contagious_diseases %>% filter(!is.na(population)) %>% 
  group_by(year, disease) %>%
  summarize(rate=sum(count)/sum(population)*10000) %>%
  ggplot(aes(year, rate,color=disease)) + geom_line()
\end{verbatim}

\begin{figure}
\centering
\includegraphics{https://user-images.githubusercontent.com/17474099/76091504-fb6e7800-5fbd-11ea-8a2b-469772c558a9.png}
\caption{index}
\end{figure}

\hypertarget{properties-of-stars-exercises}{%
\section{Properties of Stars
Exercises}\label{properties-of-stars-exercises}}

\textbf{Background}\\
Astronomy is one of the oldest data-driven sciences. In the late 1800s,
the director of the Harvard College Observatory hired women to analyze
astronomical data, which at the time was done using photographic glass
plates. These women became known as the Harvard Computers. They computed
the position and luminosity of various astronomical objects such as
stars and galaxies. (If you are interested, you can learn more about the
Harvard Computers). Today, astronomy is even more of a data-driven
science, with an inordinate amount of data being produced by modern
instruments every day.

In the following exercises we will analyze some actual astronomical data
to inspect properties of stars, their absolute magnitude (which relates
to a star's luminosity, or brightness), temperature and type (spectral
class).

\textbf{Libraries and Options}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#update.packages()}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(stars)}
\KeywordTok{options}\NormalTok{(}\DataTypeTok{digits =} \DecValTok{3}\NormalTok{)   }\CommentTok{# report 3 significant digits}
\end{Highlighting}
\end{Shaded}

\textbf{Question 1}\\
Load the stars data frame from dslabs. This contains the name, absolute
magnitude, temperature in degrees Kelvin, and spectral class of selected
stars. Absolute magnitude (shortened in these problems to simply
``magnitude'') is a function of star luminosity, where negative values
of magnitude have higher luminosity.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# What is the mean magnitude?}
\KeywordTok{mean}\NormalTok{(stars}\OperatorTok{$}\NormalTok{magnitude)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.26
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# What is the standard deviation of magnitude?}
\KeywordTok{sd}\NormalTok{(stars}\OperatorTok{$}\NormalTok{magnitude)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.35
\end{verbatim}

\textbf{Question 2}\\
Make a density plot of the magnitude.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(magnitude)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-128-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# How many peaks are there in the data?}
\CommentTok{# A: 2}
\end{Highlighting}
\end{Shaded}

\textbf{Question 3}\\
Examine the distribution of star temperature. Which of these statements
best characterizes the temperature distribution?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(temp)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-129-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# How many peaks are there in the data?}
\CommentTok{# A: 2}
\end{Highlighting}
\end{Shaded}

\textbf{Question 4}\\
Make a scatter plot of the data with temperature on the x-axis and
magnitude on the y-axis and examine the relationship between the
variables. Recall that lower magnitude means a more luminous (brighter)
star.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{temp, }\DataTypeTok{y=}\NormalTok{magnitude)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-130-1.pdf}

\textbf{Question 5}\\
For various reasons, scientists do not always follow straight
conventions when making plots, and astronomers usually transform values
of star luminosity and temperature before plotting. Flip the y-axis so
that lower values of magnitude are at the top of the axis (recall that
more luminous stars have lower magnitude) using scale\_y\_reverse. Take
the log base 10 of temperature and then also flip the x-axis.\\
Fill in the blanks in the statements below to describe the resulting
plot:\\
The brighest, highest temperature stars are in the
\_\_\_\_\_\_\_\_\_\_\_\_\_\_ corner of the plot.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{log10}\NormalTok{(temp), }\DataTypeTok{y=}\NormalTok{magnitude)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_reverse}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_reverse}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-131-1.pdf}

\textbf{Question 6}\\
The trends you see allow scientists to learn about the evolution and
lifetime of stars. The primary group of stars to which most stars belong
(see question 4) we will call the main sequence stars. Most stars belong
to this main sequence, however some of the more rare stars are
classified as old and evolved stars. These stars tend to be hotter
stars, but also have low luminosity, and are known as white dwarfs.

How many white dwarfs are there in our sample?\\
A: 4

\textbf{Question 7}\\
Consider stars which are not part of the Main Group but are not
old/evolved (white dwarf) stars. These stars must also be unique in
certain ways and are known as giants. Use the plot from Question 5 to
estimate the average temperature of a giant.

Which of these temperatures is closest to the average temperature of a
giant?: A: 5000K

\textbf{Question 8}\\
We can now identify whether specific stars are main sequence stars, red
giants or white dwarfs. Add text labels to the plot to answer these
questions. You may wish to plot only a selection of the labels, repel
the labels, or zoom in on the plot in RStudio so you can locate specific
stars.\\
Fill in the blanks in the statements below:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggrepel)}
\NormalTok{stars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{log10}\NormalTok{(temp), }\DataTypeTok{y=}\NormalTok{magnitude, }\DataTypeTok{label=}\NormalTok{star)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_reverse}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_reverse}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{label=}\NormalTok{star)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text_repel}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-132-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# The least lumninous star in the sample with a surface temperature over 5000K is _________.}
\CommentTok{# A: van Maanens Star}
\CommentTok{# The two stars with lowest temperature and highest luminosity are known as supergiants. The two supergiants in this dataset are ____________.}
\CommentTok{# A: Betelgeuse and Antares}
\CommentTok{# The Sun is a ______________.}
\CommentTok{# A: main sequence star}
\NormalTok{stars }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(star}\OperatorTok{==}\StringTok{'Sun'}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select_all}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   star magnitude temp type
## 1  Sun       4.8 5840    G
\end{verbatim}

\textbf{Question 9}\\
Remove the text labels and color the points by star type. This
classification describes the properties of the star's spectrum, the
amount of light produced at various wavelengths.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{stars }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{log10}\NormalTok{(temp), }\DataTypeTok{y=}\NormalTok{magnitude, }\DataTypeTok{color=}\NormalTok{type)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_y_reverse}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_reverse}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-133-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Which star type has the lowest temperature?}
\end{Highlighting}
\end{Shaded}

\hypertarget{climate-change-exercises}{%
\section{Climate Change Exercises}\label{climate-change-exercises}}

\textbf{Background}

The planet's surface temperature is increasing due to human greenhouse
gas emissions, and this global warming and carbon cycle disruption is
wreaking havoc on natural systems. Living systems that depend on current
temperature, weather, currents and carbon balance are jeopardized, and
human society will be forced to contend with widespread economic,
social, political and environmental damage as the temperature continues
to rise. Although most countries recognize that global warming is a
crisis and that humans must act to limit its effects, little action has
been taken to limit or reverse human impact on the climate.

One limitation is the spread of misinformation related to climate change
and its causes, especially the extent to which humans have contributed
to global warming. In these exercises, we examine the relationship
between global temperature changes, greenhouse gases and human carbon
emissions using time series of actual atmospheric and ice core
measurements from the National Oceanic and Atmospheric Administration
(NOAA) and Carbon Dioxide Information Analysis Center (CDIAC).

\textbf{Libraries and Options}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#update.packages()}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(dslabs)}
\KeywordTok{data}\NormalTok{(temp_carbon)}
\KeywordTok{data}\NormalTok{(greenhouse_gases)}
\KeywordTok{data}\NormalTok{(historic_co2)}
\end{Highlighting}
\end{Shaded}

\textbf{Question 1}\\
Load the temp\_carbon dataset from dslabs, which contains annual global
temperature anomalies (difference from 20th century mean temperature in
degrees Celsius), temperature anomalies over the land and ocean, and
global carbon emissions (in metric tons). Note that the date ranges
differ for temperature and carbon emissions.

Which of these code blocks return the latest year for which carbon
emissions are reported?

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(temp_carbon)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    268 obs. of  5 variables:
##  $ year            : num  1880 1881 1882 1883 1884 ...
##  $ temp_anomaly    : num  -0.11 -0.08 -0.1 -0.18 -0.26 -0.25 -0.24 -0.28 -0.13 -0.09 ...
##  $ land_anomaly    : num  -0.48 -0.4 -0.48 -0.66 -0.69 -0.56 -0.51 -0.47 -0.41 -0.31 ...
##  $ ocean_anomaly   : num  -0.01 0.01 0 -0.04 -0.14 -0.17 -0.17 -0.23 -0.05 -0.02 ...
##  $ carbon_emissions: num  236 243 256 272 275 277 281 295 327 327 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{    }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{max}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2018
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{pull}\NormalTok{(year) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{max}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2014
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#temp_carbon %>%}
\CommentTok{#    filter(!is.na(carbon_emissions)) %>%}
\CommentTok{#    max(year)}
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{    }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{max}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2014
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{select}\NormalTok{(year) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{max}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2014
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#temp_carbon %>%}
\CommentTok{#    filter(!is.na(carbon_emissions)) %>%}
\CommentTok{#    max(.$year)}
\end{Highlighting}
\end{Shaded}

\textbf{Question 2}\\
Inspect the difference in carbon emissions in temp\_carbon from the
first available year to the last available year.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# What is the first year for which carbon emissions (carbon_emissions) data are available?}
\NormalTok{year_min <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{min}\NormalTok{()}
\CommentTok{# What is the last year for which carbon emissions data are available?}
\NormalTok{year_max <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{max}\NormalTok{()}
\CommentTok{# How many times larger were carbon emissions in the last year relative to the first year?}
\NormalTok{ratio <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(year_min, year_max)) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{carbon_emissions}
\CommentTok{#A:}
\NormalTok{ratio[}\DecValTok{1}\NormalTok{] }\OperatorTok{/}\StringTok{ }\NormalTok{ratio[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3285
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Scatter plot}
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{year, }\DataTypeTok{y=}\NormalTok{carbon_emissions)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-136-1.pdf}

\textbf{Question 3}\\
Inspect the difference in temperature in temp\_carbon from the first
available year to the last available year.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# What is the first year for which global temperature anomaly (temp_anomaly) data are available?}
\NormalTok{year_min <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly)) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{min}\NormalTok{()}
\NormalTok{year_min}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1880
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# What is the last year for which global temperature anomaly data are available?}
\NormalTok{year_max <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly)) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{max}\NormalTok{()}
\NormalTok{year_max}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2018
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# How many degrees Celsius has temperature increased over the date range?}
\NormalTok{diff <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(year }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(year_min, year_max)) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{temp_anomaly}
\CommentTok{#A:}
\NormalTok{diff}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.11  0.82
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diff[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{diff[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -0.93
\end{verbatim}

\textbf{Question 4} Create a time series line plot of the temperature
anomaly. Only include years where temperatures are reported. Save this
plot to the object p.\\
Which command adds a blue horizontal line indicating the 20th century
mean temperature?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, temp_anomaly)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_hline}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{yintercept=}\DecValTok{0}\NormalTok{), }\DataTypeTok{color=}\StringTok{'blue'}\NormalTok{)}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-138-1.pdf}

\textbf{Question 5}\\
Continue working with p, the plot created in the previous question.

Change the y-axis label to be ``Temperature anomaly (degrees C)''. Add a
title, ``Temperature anomaly relative to 20th century mean, 1880-2018''.
Also add a text layer to the plot: the x-coordinate should be 2000, the
y-coordinate should be 0.05, the text should be ``20th century mean'',
and the text color should be blue.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{q <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, temp_anomaly)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_hline}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{yintercept=}\DecValTok{0}\NormalTok{), }\DataTypeTok{color=}\StringTok{'blue'}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Temperature anomaly (degrees C)"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Temperature anomaly relative to 20th century mean, 1880-2018"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\DecValTok{2000}\NormalTok{, }\DataTypeTok{y=}\FloatTok{0.05}\NormalTok{, }\DataTypeTok{label=}\StringTok{"20th century mean"}\NormalTok{), }\DataTypeTok{col=}\StringTok{'blue'}\NormalTok{)}
\NormalTok{q}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-139-1.pdf}

\textbf{Question 6}

When was the earliest year with a temperature above the 20th century
mean?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{year_min <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly) }\OperatorTok{&}\StringTok{ }\NormalTok{temp_anomaly}\OperatorTok{>}\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{min}\NormalTok{()}
\NormalTok{year_min}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1939
\end{verbatim}

When was the last year with an average temperature below the 20th
century mean?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{year_max <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly) }\OperatorTok{&}\StringTok{ }\NormalTok{temp_anomaly}\OperatorTok{<}\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{max}\NormalTok{()}
\NormalTok{year_max}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1976
\end{verbatim}

In what year did the temperature anomaly exceed 0.5 degrees Celsius for
the first time?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{year_ <-}\StringTok{ }\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly) }\OperatorTok{&}\StringTok{ }\NormalTok{temp_anomaly}\OperatorTok{>}\FloatTok{0.5}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{year }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{min}\NormalTok{()}
\NormalTok{year_}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1997
\end{verbatim}

\textbf{Question 7} Add layers to the previous plot to include line
graphs of the temperature anomaly in the ocean (ocean\_anomaly) and on
land (land\_anomaly). Assign different colors to the lines. Compare the
global temperature anomaly to the land temperature anomaly and ocean
temperature anomaly.

Which region has the largest 2018 temperature anomaly relative to the
20th century mean?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(temp_anomaly)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, temp_anomaly)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\DataTypeTok{col=}\StringTok{'red'}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_hline}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{yintercept=}\DecValTok{0}\NormalTok{), }\DataTypeTok{color=}\StringTok{'blue'}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{xlim}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{1880}\NormalTok{, }\DecValTok{2018}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Temperature anomaly (degrees C)"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Temperature anomaly relative to 20th century mean, 1880-2018"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\DecValTok{2000}\NormalTok{, }\DataTypeTok{y=}\FloatTok{0.05}\NormalTok{, }\DataTypeTok{label=}\StringTok{"20th century mean"}\NormalTok{), }\DataTypeTok{col=}\StringTok{'blue'}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, ocean_anomaly), }\DataTypeTok{col=}\StringTok{'cyan'}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, land_anomaly), }\DataTypeTok{col=}\StringTok{'green'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-143-1.pdf}

\textbf{Question 8} A major determinant of Earth's temperature is the
greenhouse effect. Many gases trap heat and reflect it towards the
surface, preventing heat from escaping the atmosphere. The greenhouse
effect is vital in keeping Earth at a warm enough temperature to sustain
liquid water and life; however, changes in greenhouse gas levels can
alter the temperature balance of the planet.

The greenhouse\_gases data frame from dslabs contains concentrations of
the three most significant greenhouse gases: carbon dioxide ( CO2 ,
abbreviated in the data as co2), methane ( CH4 , ch4 in the data), and
nitrous oxide ( N2O , n2o in the data). Measurements are provided every
20 years for the past 2000 years.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{str}\NormalTok{(greenhouse_gases)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    300 obs. of  3 variables:
##  $ year         : num  20 40 60 80 100 120 140 160 180 200 ...
##  $ gas          : chr  "CO2" "CO2" "CO2" "CO2" ...
##  $ concentration: num  278 278 277 277 278 ...
\end{verbatim}

Complete the code outline below to make a line plot of concentration on
the y-axis by year on the x-axis. Facet by gas, aligning the plots
vertically so as to ease comparisons along the year axis. Add a vertical
line with an x-intercept at the year 1850, noting the unofficial start
of the industrial revolution and widespread fossil fuel consumption.
Note that the units for ch4 and n2o are ppb while the units for co2 are
ppm.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{greenhouse_gases }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, concentration)) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}
\StringTok{    }\KeywordTok{facet_grid}\NormalTok{(gas }\OperatorTok{~}\StringTok{ }\NormalTok{., }\DataTypeTok{scales =} \StringTok{"free"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{geom_vline}\NormalTok{(}\DataTypeTok{xintercept =} \DecValTok{1850}\NormalTok{, }\DataTypeTok{col=}\StringTok{'red'}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ylab}\NormalTok{(}\StringTok{"Concentration (ch4/n2o ppb, co2 ppm)"}\NormalTok{) }\OperatorTok{+}
\StringTok{    }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Atmospheric greenhouse gas concentration by year, 0-2000"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-145-1.pdf}

\textbf{Question 10} Make a time series line plot of carbon emissions
(carbon\_emissions) from the temp\_carbon dataset. The y-axis is metric
tons of carbon emitted per year.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{temp_carbon }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(carbon_emissions)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, carbon_emissions)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-146-1.pdf}

\textbf{Question 11}\\
We saw how greenhouse gases have changed over the course of human
history, but how has CO2 (co2 in the data) varied over a longer time
scale? The historic\_co2 data frame in dslabs contains direct
measurements of atmospheric co2 from Mauna Loa since 1959 as well as
indirect measurements of atmospheric co2 from ice cores dating back
800,000 years.

Make a line plot of co2 concentration over time (year), coloring by the
measurement source (source). Save this plot as co2\_time for later use.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{co2_time <-}\StringTok{ }\NormalTok{historic_co2 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(co2)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(year, co2, }\DataTypeTok{col=}\NormalTok{source)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{ggtitle}\NormalTok{(}\StringTok{"Atmospheric CO2 concentration, -800,000 BC to today"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{ylab}\NormalTok{(}\StringTok{"co2 (ppmv)"}\NormalTok{)}
\NormalTok{co2_time}
\end{Highlighting}
\end{Shaded}

\includegraphics{Data_Science_Visualization_files/figure-latex/unnamed-chunk-147-1.pdf}

\textbf{Question 12}\\
One way to differentiate natural co2 oscillations from today's manmade
co2 spike is by examining the rate of change of co2. The planet is
affected not only by the absolute concentration of co2 but also by its
rate of change. When the rate of change is slow, living and nonliving
systems have time to adapt to new temperature and gas levels, but when
the rate of change is fast, abrupt differences can overwhelm natural
systems. How does the pace of natural co2 change differ from the current
rate of change?

Use the co2\_time plot saved above. Change the limits as directed to
investigate the rate of change in co2 over various periods with spikes
in co2 concentration.

\end{document}
